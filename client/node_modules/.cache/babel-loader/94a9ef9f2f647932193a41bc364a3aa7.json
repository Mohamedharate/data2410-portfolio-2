{"ast":null,"code":"'use strict';\n\nconst EventEmitter = require('events').EventEmitter;\n\nconst inherits = require('util').inherits;\n\nconst getSingleProperty = require('./utils').getSingleProperty;\n\nconst CommandCursor = require('./command_cursor');\n\nconst handleCallback = require('./utils').handleCallback;\n\nconst filterOptions = require('./utils').filterOptions;\n\nconst toError = require('./utils').toError;\n\nconst ReadPreference = require('./core').ReadPreference;\n\nconst MongoError = require('./core').MongoError;\n\nconst ObjectID = require('./core').ObjectID;\n\nconst Logger = require('./core').Logger;\n\nconst Collection = require('./collection');\n\nconst conditionallyMergeWriteConcern = require('./utils').conditionallyMergeWriteConcern;\n\nconst executeLegacyOperation = require('./utils').executeLegacyOperation;\n\nconst ChangeStream = require('./change_stream');\n\nconst deprecate = require('util').deprecate;\n\nconst deprecateOptions = require('./utils').deprecateOptions;\n\nconst MongoDBNamespace = require('./utils').MongoDBNamespace;\n\nconst CONSTANTS = require('./constants');\n\nconst WriteConcern = require('./write_concern');\n\nconst ReadConcern = require('./read_concern');\n\nconst AggregationCursor = require('./aggregation_cursor'); // Operations\n\n\nconst createListener = require('./operations/db_ops').createListener;\n\nconst ensureIndex = require('./operations/db_ops').ensureIndex;\n\nconst evaluate = require('./operations/db_ops').evaluate;\n\nconst profilingInfo = require('./operations/db_ops').profilingInfo;\n\nconst validateDatabaseName = require('./operations/db_ops').validateDatabaseName;\n\nconst AggregateOperation = require('./operations/aggregate');\n\nconst AddUserOperation = require('./operations/add_user');\n\nconst CollectionsOperation = require('./operations/collections');\n\nconst CommandOperation = require('./operations/command');\n\nconst RunCommandOperation = require('./operations/run_command');\n\nconst CreateCollectionOperation = require('./operations/create_collection');\n\nconst CreateIndexesOperation = require('./operations/create_indexes');\n\nconst DropCollectionOperation = require('./operations/drop').DropCollectionOperation;\n\nconst DropDatabaseOperation = require('./operations/drop').DropDatabaseOperation;\n\nconst ExecuteDbAdminCommandOperation = require('./operations/execute_db_admin_command');\n\nconst IndexInformationOperation = require('./operations/index_information');\n\nconst ListCollectionsOperation = require('./operations/list_collections');\n\nconst ProfilingLevelOperation = require('./operations/profiling_level');\n\nconst RemoveUserOperation = require('./operations/remove_user');\n\nconst RenameOperation = require('./operations/rename');\n\nconst SetProfilingLevelOperation = require('./operations/set_profiling_level');\n\nconst executeOperation = require('./operations/execute_operation');\n/**\r\n * @fileOverview The **Db** class is a class that represents a MongoDB Database.\r\n *\r\n * @example\r\n * const MongoClient = require('mongodb').MongoClient;\r\n * // Connection url\r\n * const url = 'mongodb://localhost:27017';\r\n * // Database Name\r\n * const dbName = 'test';\r\n * // Connect using MongoClient\r\n * MongoClient.connect(url, function(err, client) {\r\n *   // Select the database by name\r\n *   const testDb = client.db(dbName);\r\n *   client.close();\r\n * });\r\n */\n// Allowed parameters\n\n\nconst legalOptionNames = ['w', 'wtimeout', 'fsync', 'j', 'writeConcern', 'readPreference', 'readPreferenceTags', 'native_parser', 'forceServerObjectId', 'pkFactory', 'serializeFunctions', 'raw', 'bufferMaxEntries', 'authSource', 'ignoreUndefined', 'promoteLongs', 'promiseLibrary', 'readConcern', 'retryMiliSeconds', 'numberOfRetries', 'parentDb', 'noListener', 'loggerLevel', 'logger', 'promoteBuffers', 'promoteLongs', 'promoteValues', 'compression', 'retryWrites'];\n/**\r\n * Creates a new Db instance\r\n * @class\r\n * @param {string} databaseName The name of the database this instance represents.\r\n * @param {(Server|ReplSet|Mongos)} topology The server topology for the database.\r\n * @param {object} [options] Optional settings.\r\n * @param {string} [options.authSource] If the database authentication is dependent on another databaseName.\r\n * @param {(number|string)} [options.w] **Deprecated** The write concern. Use writeConcern instead.\r\n * @param {number} [options.wtimeout] **Deprecated** The write concern timeout. Use writeConcern instead.\r\n * @param {boolean} [options.j=false] **Deprecated** Specify a journal write concern. Use writeConcern instead.\r\n * @param {object|WriteConcern} [options.writeConcern] Specify write concern settings.\r\n * @param {boolean} [options.forceServerObjectId=false] Force server to assign _id values instead of driver.\r\n * @param {boolean} [options.serializeFunctions=false] Serialize functions on any object.\r\n * @param {Boolean} [options.ignoreUndefined=false] Specify if the BSON serializer should ignore undefined fields.\r\n * @param {boolean} [options.raw=false] Return document results as raw BSON buffers.\r\n * @param {boolean} [options.promoteLongs=true] Promotes Long values to number if they fit inside the 53 bits resolution.\r\n * @param {boolean} [options.promoteBuffers=false] Promotes Binary BSON values to native Node Buffers.\r\n * @param {boolean} [options.promoteValues=true] Promotes BSON values to native types where possible, set to false to only receive wrapper types.\r\n * @param {number} [options.bufferMaxEntries=-1] Sets a cap on how many operations the driver will buffer up before giving up on getting a working connection, default is -1 which is unlimited.\r\n * @param {(ReadPreference|string)} [options.readPreference] The preferred read preference (ReadPreference.PRIMARY, ReadPreference.PRIMARY_PREFERRED, ReadPreference.SECONDARY, ReadPreference.SECONDARY_PREFERRED, ReadPreference.NEAREST).\r\n * @param {object} [options.pkFactory] A primary key factory object for generation of custom _id keys.\r\n * @param {object} [options.promiseLibrary] A Promise library class the application wishes to use such as Bluebird, must be ES6 compatible\r\n * @param {object} [options.readConcern] Specify a read concern for the collection. (only MongoDB 3.2 or higher supported)\r\n * @param {ReadConcernLevel} [options.readConcern.level='local'] Specify a read concern level for the collection operations (only MongoDB 3.2 or higher supported)\r\n * @property {(Server|ReplSet|Mongos)} serverConfig Get the current db topology.\r\n * @property {number} bufferMaxEntries Current bufferMaxEntries value for the database\r\n * @property {string} databaseName The name of the database this instance represents.\r\n * @property {object} options The options associated with the db instance.\r\n * @property {boolean} native_parser The current value of the parameter native_parser.\r\n * @property {boolean} slaveOk The current slaveOk value for the db instance.\r\n * @property {object} writeConcern The current write concern values.\r\n * @property {object} topology Access the topology object (single server, replicaset or mongos).\r\n * @fires Db#close\r\n * @fires Db#reconnect\r\n * @fires Db#error\r\n * @fires Db#timeout\r\n * @fires Db#parseError\r\n * @fires Db#fullsetup\r\n * @return {Db} a Db instance.\r\n */\n\nfunction Db(databaseName, topology, options) {\n  options = options || {};\n  if (!(this instanceof Db)) return new Db(databaseName, topology, options);\n  EventEmitter.call(this); // Get the promiseLibrary\n\n  const promiseLibrary = options.promiseLibrary || Promise; // Filter the options\n\n  options = filterOptions(options, legalOptionNames); // Ensure we put the promiseLib in the options\n\n  options.promiseLibrary = promiseLibrary; // Internal state of the db object\n\n  this.s = {\n    // DbCache\n    dbCache: {},\n    // Children db's\n    children: [],\n    // Topology\n    topology: topology,\n    // Options\n    options: options,\n    // Logger instance\n    logger: Logger('Db', options),\n    // Get the bson parser\n    bson: topology ? topology.bson : null,\n    // Unpack read preference\n    readPreference: ReadPreference.fromOptions(options),\n    // Set buffermaxEntries\n    bufferMaxEntries: typeof options.bufferMaxEntries === 'number' ? options.bufferMaxEntries : -1,\n    // Parent db (if chained)\n    parentDb: options.parentDb || null,\n    // Set up the primary key factory or fallback to ObjectID\n    pkFactory: options.pkFactory || ObjectID,\n    // Get native parser\n    nativeParser: options.nativeParser || options.native_parser,\n    // Promise library\n    promiseLibrary: promiseLibrary,\n    // No listener\n    noListener: typeof options.noListener === 'boolean' ? options.noListener : false,\n    // ReadConcern\n    readConcern: ReadConcern.fromOptions(options),\n    writeConcern: WriteConcern.fromOptions(options),\n    // Namespace\n    namespace: new MongoDBNamespace(databaseName)\n  }; // Ensure we have a valid db name\n\n  validateDatabaseName(databaseName); // Add a read Only property\n\n  getSingleProperty(this, 'serverConfig', this.s.topology);\n  getSingleProperty(this, 'bufferMaxEntries', this.s.bufferMaxEntries);\n  getSingleProperty(this, 'databaseName', this.s.namespace.db); // This is a child db, do not register any listeners\n\n  if (options.parentDb) return;\n  if (this.s.noListener) return; // Add listeners\n\n  topology.on('error', createListener(this, 'error', this));\n  topology.on('timeout', createListener(this, 'timeout', this));\n  topology.on('close', createListener(this, 'close', this));\n  topology.on('parseError', createListener(this, 'parseError', this));\n  topology.once('open', createListener(this, 'open', this));\n  topology.once('fullsetup', createListener(this, 'fullsetup', this));\n  topology.once('all', createListener(this, 'all', this));\n  topology.on('reconnect', createListener(this, 'reconnect', this));\n}\n\ninherits(Db, EventEmitter);\nDb.prototype.on = deprecate(function () {\n  return Db.super_.prototype.on.apply(this, arguments);\n}, 'Listening to events on the Db class has been deprecated and will be removed in the next major version.');\nDb.prototype.once = deprecate(function () {\n  return Db.super_.prototype.once.apply(this, arguments);\n}, 'Listening to events on the Db class has been deprecated and will be removed in the next major version.'); // Topology\n\nObject.defineProperty(Db.prototype, 'topology', {\n  enumerable: true,\n  get: function () {\n    return this.s.topology;\n  }\n}); // Options\n\nObject.defineProperty(Db.prototype, 'options', {\n  enumerable: true,\n  get: function () {\n    return this.s.options;\n  }\n}); // slaveOk specified\n\nObject.defineProperty(Db.prototype, 'slaveOk', {\n  enumerable: true,\n  get: function () {\n    if (this.s.options.readPreference != null && (this.s.options.readPreference !== 'primary' || this.s.options.readPreference.mode !== 'primary')) {\n      return true;\n    }\n\n    return false;\n  }\n});\nObject.defineProperty(Db.prototype, 'readConcern', {\n  enumerable: true,\n  get: function () {\n    return this.s.readConcern;\n  }\n});\nObject.defineProperty(Db.prototype, 'readPreference', {\n  enumerable: true,\n  get: function () {\n    if (this.s.readPreference == null) {\n      // TODO: check client\n      return ReadPreference.primary;\n    }\n\n    return this.s.readPreference;\n  }\n}); // get the write Concern\n\nObject.defineProperty(Db.prototype, 'writeConcern', {\n  enumerable: true,\n  get: function () {\n    return this.s.writeConcern;\n  }\n});\nObject.defineProperty(Db.prototype, 'namespace', {\n  enumerable: true,\n  get: function () {\n    return this.s.namespace.toString();\n  }\n});\n/**\r\n * Execute a command\r\n * @method\r\n * @param {object} command The command hash\r\n * @param {object} [options] Optional settings.\r\n * @param {(ReadPreference|string)} [options.readPreference] The preferred read preference (ReadPreference.PRIMARY, ReadPreference.PRIMARY_PREFERRED, ReadPreference.SECONDARY, ReadPreference.SECONDARY_PREFERRED, ReadPreference.NEAREST).\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~resultCallback} [callback] The command result callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\n\nDb.prototype.command = function (command, options, callback) {\n  if (typeof options === 'function') callback = options, options = {};\n  options = Object.assign({}, options);\n  const commandOperation = new RunCommandOperation(this, command, options);\n  return executeOperation(this.s.topology, commandOperation, callback);\n};\n/**\r\n * Execute an aggregation framework pipeline against the database, needs MongoDB >= 3.6\r\n * @method\r\n * @param {object} [pipeline=[]] Array containing all the aggregation framework commands for the execution.\r\n * @param {object} [options] Optional settings.\r\n * @param {(ReadPreference|string)} [options.readPreference] The preferred read preference (ReadPreference.PRIMARY, ReadPreference.PRIMARY_PREFERRED, ReadPreference.SECONDARY, ReadPreference.SECONDARY_PREFERRED, ReadPreference.NEAREST).\r\n * @param {number} [options.batchSize=1000] The number of documents to return per batch. See {@link https://docs.mongodb.com/manual/reference/command/aggregate|aggregation documentation}.\r\n * @param {object} [options.cursor] Return the query as cursor, on 2.6 > it returns as a real cursor on pre 2.6 it returns as an emulated cursor.\r\n * @param {number} [options.cursor.batchSize=1000] Deprecated. Use `options.batchSize`\r\n * @param {'queryPlanner'|'queryPlannerExtended'|'executionStats'|'allPlansExecution'|boolean} [options.explain] The verbosity mode for the explain output.\r\n * @param {boolean} [options.allowDiskUse=false] allowDiskUse lets the server know if it can use disk to store temporary results for the aggregation (requires mongodb 2.6 >).\r\n * @param {number} [options.maxTimeMS] maxTimeMS specifies a cumulative time limit in milliseconds for processing operations on the cursor. MongoDB interrupts the operation at the earliest following interrupt point.\r\n * @param {number} [options.maxAwaitTimeMS] The maximum amount of time for the server to wait on new documents to satisfy a tailable cursor query.\r\n * @param {boolean} [options.bypassDocumentValidation=false] Allow driver to bypass schema validation in MongoDB 3.2 or higher.\r\n * @param {boolean} [options.raw=false] Return document results as raw BSON buffers.\r\n * @param {boolean} [options.promoteLongs=true] Promotes Long values to number if they fit inside the 53 bits resolution.\r\n * @param {boolean} [options.promoteValues=true] Promotes BSON values to native types where possible, set to false to only receive wrapper types.\r\n * @param {boolean} [options.promoteBuffers=false] Promotes Binary BSON values to native Node Buffers.\r\n * @param {object} [options.collation] Specify collation (MongoDB 3.4 or higher) settings for update operation (see 3.4 documentation for available fields).\r\n * @param {string} [options.comment] Add a comment to an aggregation command\r\n * @param {string|object} [options.hint] Add an index selection hint to an aggregation command\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Database~aggregationCallback} callback The command result callback\r\n * @return {(null|AggregationCursor)}\r\n */\n\n\nDb.prototype.aggregate = function (pipeline, options, callback) {\n  if (typeof options === 'function') {\n    callback = options;\n    options = {};\n  } // If we have no options or callback we are doing\n  // a cursor based aggregation\n\n\n  if (options == null && callback == null) {\n    options = {};\n  }\n\n  const cursor = new AggregationCursor(this.s.topology, new AggregateOperation(this, pipeline, options), options); // TODO: remove this when NODE-2074 is resolved\n\n  if (typeof callback === 'function') {\n    callback(null, cursor);\n    return;\n  }\n\n  return cursor;\n};\n/**\r\n * Return the Admin db instance\r\n * @method\r\n * @return {Admin} return the new Admin db instance\r\n */\n\n\nDb.prototype.admin = function () {\n  const Admin = require('./admin');\n\n  return new Admin(this, this.s.topology, this.s.promiseLibrary);\n};\n/**\r\n * The callback format for the collection method, must be used if strict is specified\r\n * @callback Db~collectionResultCallback\r\n * @param {MongoError} error An error instance representing the error during the execution.\r\n * @param {Collection} collection The collection instance.\r\n */\n\n/**\r\n * The callback format for an aggregation call\r\n * @callback Database~aggregationCallback\r\n * @param {MongoError} error An error instance representing the error during the execution.\r\n * @param {AggregationCursor} cursor The cursor if the aggregation command was executed successfully.\r\n */\n\n\nconst COLLECTION_OPTION_KEYS = ['pkFactory', 'readPreference', 'serializeFunctions', 'strict', 'readConcern', 'ignoreUndefined', 'promoteValues', 'promoteBuffers', 'promoteLongs'];\n/**\r\n * Fetch a specific collection (containing the actual collection information). If the application does not use strict mode you\r\n * can use it without a callback in the following way: `const collection = db.collection('mycollection');`\r\n *\r\n * @method\r\n * @param {string} name the collection name we wish to access.\r\n * @param {object} [options] Optional settings.\r\n * @param {(number|string)} [options.w] **Deprecated** The write concern. Use writeConcern instead.\r\n * @param {number} [options.wtimeout] **Deprecated** The write concern timeout. Use writeConcern instead.\r\n * @param {boolean} [options.j=false] **Deprecated** Specify a journal write concern. Use writeConcern instead.\r\n * @param {object|WriteConcern} [options.writeConcern] Specify write concern settings.\r\n * @param {boolean} [options.raw=false] Return document results as raw BSON buffers.\r\n * @param {object} [options.pkFactory] A primary key factory object for generation of custom _id keys.\r\n * @param {(ReadPreference|string)} [options.readPreference] The preferred read preference (ReadPreference.PRIMARY, ReadPreference.PRIMARY_PREFERRED, ReadPreference.SECONDARY, ReadPreference.SECONDARY_PREFERRED, ReadPreference.NEAREST).\r\n * @param {boolean} [options.serializeFunctions=false] Serialize functions on any object.\r\n * @param {boolean} [options.strict=false] Returns an error if the collection does not exist\r\n * @param {object} [options.readConcern] Specify a read concern for the collection. (only MongoDB 3.2 or higher supported)\r\n * @param {ReadConcernLevel} [options.readConcern.level='local'] Specify a read concern level for the collection operations (only MongoDB 3.2 or higher supported)\r\n * @param {Db~collectionResultCallback} [callback] The collection result callback\r\n * @return {Collection} return the new Collection instance if not in strict mode\r\n */\n\nDb.prototype.collection = function (name, options, callback) {\n  if (typeof options === 'function') callback = options, options = {};\n  options = options || {};\n  options = Object.assign({}, options); // Set the promise library\n\n  options.promiseLibrary = this.s.promiseLibrary; // If we have not set a collection level readConcern set the db level one\n\n  options.readConcern = options.readConcern ? new ReadConcern(options.readConcern.level) : this.readConcern; // Do we have ignoreUndefined set\n\n  if (this.s.options.ignoreUndefined) {\n    options.ignoreUndefined = this.s.options.ignoreUndefined;\n  }\n\n  for (const collectionOptionKey of COLLECTION_OPTION_KEYS) {\n    if (!(collectionOptionKey in options) && this.s.options[collectionOptionKey] !== undefined) {\n      options[collectionOptionKey] = this.s.options[collectionOptionKey];\n    }\n  } // Merge in all needed options and ensure correct writeConcern merging from db level\n\n\n  options = conditionallyMergeWriteConcern(options, this.s.options); // Execute\n\n  if (options == null || !options.strict) {\n    try {\n      const collection = new Collection(this, this.s.topology, this.databaseName, name, this.s.pkFactory, options);\n      if (callback) callback(null, collection);\n      return collection;\n    } catch (err) {\n      if (err instanceof MongoError && callback) return callback(err);\n      throw err;\n    }\n  } // Strict mode\n\n\n  if (typeof callback !== 'function') {\n    throw toError(`A callback is required in strict mode. While getting collection ${name}`);\n  } // Did the user destroy the topology\n\n\n  if (this.serverConfig && this.serverConfig.isDestroyed()) {\n    return callback(new MongoError('topology was destroyed'));\n  }\n\n  const listCollectionOptions = Object.assign({}, options, {\n    nameOnly: true\n  }); // Strict mode\n\n  this.listCollections({\n    name: name\n  }, listCollectionOptions).toArray((err, collections) => {\n    if (err != null) return handleCallback(callback, err, null);\n    if (collections.length === 0) return handleCallback(callback, toError(`Collection ${name} does not exist. Currently in strict mode.`), null);\n\n    try {\n      return handleCallback(callback, null, new Collection(this, this.s.topology, this.databaseName, name, this.s.pkFactory, options));\n    } catch (err) {\n      return handleCallback(callback, err, null);\n    }\n  });\n};\n/**\r\n * Create a new collection on a server with the specified options. Use this to create capped collections.\r\n * More information about command options available at https://docs.mongodb.com/manual/reference/command/create/\r\n *\r\n * @method\r\n * @param {string} name the collection name we wish to access.\r\n * @param {object} [options] Optional settings.\r\n * @param {(number|string)} [options.w] **Deprecated** The write concern. Use writeConcern instead.\r\n * @param {number} [options.wtimeout] **Deprecated** The write concern timeout. Use writeConcern instead.\r\n * @param {boolean} [options.j=false] **Deprecated** Specify a journal write concern. Use writeConcern instead.\r\n * @param {object|WriteConcern} [options.writeConcern] Specify write concern settings.\r\n * @param {boolean} [options.raw=false] Return document results as raw BSON buffers.\r\n * @param {object} [options.pkFactory] A primary key factory object for generation of custom _id keys.\r\n * @param {(ReadPreference|string)} [options.readPreference] The preferred read preference (ReadPreference.PRIMARY, ReadPreference.PRIMARY_PREFERRED, ReadPreference.SECONDARY, ReadPreference.SECONDARY_PREFERRED, ReadPreference.NEAREST).\r\n * @param {boolean} [options.serializeFunctions=false] Serialize functions on any object.\r\n * @param {boolean} [options.strict=false] DEPRECATED: Returns an error if the collection does not exist\r\n * @param {boolean} [options.capped=false] Create a capped collection.\r\n * @param {boolean} [options.autoIndexId=true] DEPRECATED: Create an index on the _id field of the document, True by default on MongoDB 2.6 - 3.0\r\n * @param {number} [options.size] The size of the capped collection in bytes.\r\n * @param {number} [options.max] The maximum number of documents in the capped collection.\r\n * @param {number} [options.flags] Optional. Available for the MMAPv1 storage engine only to set the usePowerOf2Sizes and the noPadding flag.\r\n * @param {object} [options.storageEngine] Allows users to specify configuration to the storage engine on a per-collection basis when creating a collection on MongoDB 3.0 or higher.\r\n * @param {object} [options.validator] Allows users to specify validation rules or expressions for the collection. For more information, see Document Validation on MongoDB 3.2 or higher.\r\n * @param {string} [options.validationLevel] Determines how strictly MongoDB applies the validation rules to existing documents during an update on MongoDB 3.2 or higher.\r\n * @param {string} [options.validationAction] Determines whether to error on invalid documents or just warn about the violations but allow invalid documents to be inserted on MongoDB 3.2 or higher.\r\n * @param {object} [options.indexOptionDefaults] Allows users to specify a default configuration for indexes when creating a collection on MongoDB 3.2 or higher.\r\n * @param {string} [options.viewOn] The name of the source collection or view from which to create the view. The name is not the full namespace of the collection or view; i.e. does not include the database name and implies the same database as the view to create on MongoDB 3.4 or higher.\r\n * @param {array} [options.pipeline] An array that consists of the aggregation pipeline stage. Creates the view by applying the specified pipeline to the viewOn collection or view on MongoDB 3.4 or higher.\r\n * @param {object} [options.collation] Specify collation (MongoDB 3.4 or higher) settings for update operation (see 3.4 documentation for available fields).\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~collectionResultCallback} [callback] The results callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\n\n\nDb.prototype.createCollection = deprecateOptions({\n  name: 'Db.createCollection',\n  deprecatedOptions: ['autoIndexId', 'strict', 'w', 'wtimeout', 'j'],\n  optionsIndex: 1\n}, function (name, options, callback) {\n  if (typeof options === 'function') callback = options, options = {};\n  options = options || {};\n  options.promiseLibrary = options.promiseLibrary || this.s.promiseLibrary;\n  options.readConcern = options.readConcern ? new ReadConcern(options.readConcern.level) : this.readConcern;\n  const createCollectionOperation = new CreateCollectionOperation(this, name, options);\n  return executeOperation(this.s.topology, createCollectionOperation, callback);\n});\n/**\r\n * Get all the db statistics.\r\n *\r\n * @method\r\n * @param {object} [options] Optional settings.\r\n * @param {number} [options.scale] Divide the returned sizes by scale value.\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~resultCallback} [callback] The collection result callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\n\nDb.prototype.stats = function (options, callback) {\n  if (typeof options === 'function') callback = options, options = {};\n  options = options || {}; // Build command object\n\n  const commandObject = {\n    dbStats: true\n  }; // Check if we have the scale value\n\n  if (options['scale'] != null) commandObject['scale'] = options['scale']; // If we have a readPreference set\n\n  if (options.readPreference == null && this.s.readPreference) {\n    options.readPreference = this.s.readPreference;\n  }\n\n  const statsOperation = new CommandOperation(this, options, null, commandObject); // Execute the command\n\n  return executeOperation(this.s.topology, statsOperation, callback);\n};\n/**\r\n * Get the list of all collection information for the specified db.\r\n *\r\n * @method\r\n * @param {object} [filter={}] Query to filter collections by\r\n * @param {object} [options] Optional settings.\r\n * @param {boolean} [options.nameOnly=false] Since 4.0: If true, will only return the collection name in the response, and will omit additional info\r\n * @param {number} [options.batchSize=1000] The batchSize for the returned command cursor or if pre 2.8 the systems batch collection\r\n * @param {(ReadPreference|string)} [options.readPreference] The preferred read preference (ReadPreference.PRIMARY, ReadPreference.PRIMARY_PREFERRED, ReadPreference.SECONDARY, ReadPreference.SECONDARY_PREFERRED, ReadPreference.NEAREST).\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @return {CommandCursor}\r\n */\n\n\nDb.prototype.listCollections = function (filter, options) {\n  filter = filter || {};\n  options = options || {};\n  return new CommandCursor(this.s.topology, new ListCollectionsOperation(this, filter, options), options);\n};\n/**\r\n * Evaluate JavaScript on the server\r\n *\r\n * @method\r\n * @param {Code} code JavaScript to execute on server.\r\n * @param {(object|array)} parameters The parameters for the call.\r\n * @param {object} [options] Optional settings.\r\n * @param {boolean} [options.nolock=false] Tell MongoDB not to block on the evaluation of the javascript.\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~resultCallback} [callback] The results callback\r\n * @deprecated Eval is deprecated on MongoDB 3.2 and forward\r\n * @return {Promise} returns Promise if no callback passed\r\n */\n\n\nDb.prototype.eval = deprecate(function (code, parameters, options, callback) {\n  const args = Array.prototype.slice.call(arguments, 1);\n  callback = typeof args[args.length - 1] === 'function' ? args.pop() : undefined;\n  parameters = args.length ? args.shift() : parameters;\n  options = args.length ? args.shift() || {} : {};\n  return executeLegacyOperation(this.s.topology, evaluate, [this, code, parameters, options, callback]);\n}, 'Db.eval is deprecated as of MongoDB version 3.2');\n/**\r\n * Rename a collection.\r\n *\r\n * @method\r\n * @param {string} fromCollection Name of current collection to rename.\r\n * @param {string} toCollection New name of of the collection.\r\n * @param {object} [options] Optional settings.\r\n * @param {boolean} [options.dropTarget=false] Drop the target name collection if it previously exists.\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~collectionResultCallback} [callback] The results callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\n\nDb.prototype.renameCollection = function (fromCollection, toCollection, options, callback) {\n  if (typeof options === 'function') callback = options, options = {};\n  options = Object.assign({}, options, {\n    readPreference: ReadPreference.PRIMARY\n  }); // Add return new collection\n\n  options.new_collection = true;\n  const renameOperation = new RenameOperation(this.collection(fromCollection), toCollection, options);\n  return executeOperation(this.s.topology, renameOperation, callback);\n};\n/**\r\n * Drop a collection from the database, removing it permanently. New accesses will create a new collection.\r\n *\r\n * @method\r\n * @param {string} name Name of collection to drop\r\n * @param {Object} [options] Optional settings\r\n * @param {(number|string)} [options.w] **Deprecated** The write concern. Use writeConcern instead.\r\n * @param {number} [options.wtimeout] **Deprecated** The write concern timeout. Use writeConcern instead.\r\n * @param {boolean} [options.j=false] **Deprecated** Specify a journal write concern. Use writeConcern instead.\r\n * @param {object|WriteConcern} [options.writeConcern] Specify write concern settings.\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~resultCallback} [callback] The results callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\n\n\nDb.prototype.dropCollection = function (name, options, callback) {\n  if (typeof options === 'function') callback = options, options = {};\n  options = options || {};\n  const dropCollectionOperation = new DropCollectionOperation(this, name, options);\n  return executeOperation(this.s.topology, dropCollectionOperation, callback);\n};\n/**\r\n * Drop a database, removing it permanently from the server.\r\n *\r\n * @method\r\n * @param {Object} [options] Optional settings\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~resultCallback} [callback] The results callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\n\n\nDb.prototype.dropDatabase = function (options, callback) {\n  if (typeof options === 'function') callback = options, options = {};\n  options = options || {};\n  const dropDatabaseOperation = new DropDatabaseOperation(this, options);\n  return executeOperation(this.s.topology, dropDatabaseOperation, callback);\n};\n/**\r\n * Fetch all collections for the current db.\r\n *\r\n * @method\r\n * @param {Object} [options] Optional settings\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~collectionsResultCallback} [callback] The results callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\n\n\nDb.prototype.collections = function (options, callback) {\n  if (typeof options === 'function') callback = options, options = {};\n  options = options || {};\n  const collectionsOperation = new CollectionsOperation(this, options);\n  return executeOperation(this.s.topology, collectionsOperation, callback);\n};\n/**\r\n * Runs a command on the database as admin.\r\n * @method\r\n * @param {object} command The command hash\r\n * @param {object} [options] Optional settings.\r\n * @param {(ReadPreference|string)} [options.readPreference] The preferred read preference (ReadPreference.PRIMARY, ReadPreference.PRIMARY_PREFERRED, ReadPreference.SECONDARY, ReadPreference.SECONDARY_PREFERRED, ReadPreference.NEAREST).\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~resultCallback} [callback] The command result callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\n\n\nDb.prototype.executeDbAdminCommand = function (selector, options, callback) {\n  if (typeof options === 'function') callback = options, options = {};\n  options = options || {};\n  options.readPreference = ReadPreference.resolve(this, options);\n  const executeDbAdminCommandOperation = new ExecuteDbAdminCommandOperation(this, selector, options);\n  return executeOperation(this.s.topology, executeDbAdminCommandOperation, callback);\n};\n/**\r\n * Creates an index on the db and collection.\r\n * @method\r\n * @param {string} name Name of the collection to create the index on.\r\n * @param {(string|object)} fieldOrSpec Defines the index.\r\n * @param {object} [options] Optional settings.\r\n * @param {(number|string)} [options.w] **Deprecated** The write concern. Use writeConcern instead.\r\n * @param {number} [options.wtimeout] **Deprecated** The write concern timeout. Use writeConcern instead.\r\n * @param {boolean} [options.j=false] **Deprecated** Specify a journal write concern. Use writeConcern instead.\r\n * @param {object|WriteConcern} [options.writeConcern] Specify write concern settings.\r\n * @param {boolean} [options.unique=false] Creates an unique index.\r\n * @param {boolean} [options.sparse=false] Creates a sparse index.\r\n * @param {boolean} [options.background=false] Creates the index in the background, yielding whenever possible.\r\n * @param {boolean} [options.dropDups=false] A unique index cannot be created on a key that has pre-existing duplicate values. If you would like to create the index anyway, keeping the first document the database indexes and deleting all subsequent documents that have duplicate value\r\n * @param {number} [options.min] For geospatial indexes set the lower bound for the co-ordinates.\r\n * @param {number} [options.max] For geospatial indexes set the high bound for the co-ordinates.\r\n * @param {number} [options.v] Specify the format version of the indexes.\r\n * @param {number} [options.expireAfterSeconds] Allows you to expire data on indexes applied to a data (MongoDB 2.2 or higher)\r\n * @param {string} [options.name] Override the autogenerated index name (useful if the resulting name is larger than 128 bytes)\r\n * @param {object} [options.partialFilterExpression] Creates a partial index based on the given filter object (MongoDB 3.2 or higher)\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {(number|string)} [options.commitQuorum] (MongoDB 4.4. or higher) Specifies how many data-bearing members of a replica set, including the primary, must complete the index builds successfully before the primary marks the indexes as ready. This option accepts the same values for the \"w\" field in a write concern plus \"votingMembers\", which indicates all voting data-bearing nodes.\r\n * @param {Db~resultCallback} [callback] The command result callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\n\n\nDb.prototype.createIndex = function (name, fieldOrSpec, options, callback) {\n  if (typeof options === 'function') callback = options, options = {};\n  options = options ? Object.assign({}, options) : {};\n  const createIndexesOperation = new CreateIndexesOperation(this, name, fieldOrSpec, options);\n  return executeOperation(this.s.topology, createIndexesOperation, callback);\n};\n/**\r\n * Ensures that an index exists, if it does not it creates it\r\n * @method\r\n * @deprecated since version 2.0\r\n * @param {string} name The index name\r\n * @param {(string|object)} fieldOrSpec Defines the index.\r\n * @param {object} [options] Optional settings.\r\n * @param {(number|string)} [options.w] **Deprecated** The write concern. Use writeConcern instead.\r\n * @param {number} [options.wtimeout] **Deprecated** The write concern timeout. Use writeConcern instead.\r\n * @param {boolean} [options.j=false] **Deprecated** Specify a journal write concern. Use writeConcern instead.\r\n * @param {object|WriteConcern} [options.writeConcern] Specify write concern settings.\r\n * @param {boolean} [options.unique=false] Creates an unique index.\r\n * @param {boolean} [options.sparse=false] Creates a sparse index.\r\n * @param {boolean} [options.background=false] Creates the index in the background, yielding whenever possible.\r\n * @param {boolean} [options.dropDups=false] A unique index cannot be created on a key that has pre-existing duplicate values. If you would like to create the index anyway, keeping the first document the database indexes and deleting all subsequent documents that have duplicate value\r\n * @param {number} [options.min] For geospatial indexes set the lower bound for the co-ordinates.\r\n * @param {number} [options.max] For geospatial indexes set the high bound for the co-ordinates.\r\n * @param {number} [options.v] Specify the format version of the indexes.\r\n * @param {number} [options.expireAfterSeconds] Allows you to expire data on indexes applied to a data (MongoDB 2.2 or higher)\r\n * @param {number} [options.name] Override the autogenerated index name (useful if the resulting name is larger than 128 bytes)\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~resultCallback} [callback] The command result callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\n\n\nDb.prototype.ensureIndex = deprecate(function (name, fieldOrSpec, options, callback) {\n  if (typeof options === 'function') callback = options, options = {};\n  options = options || {};\n  return executeLegacyOperation(this.s.topology, ensureIndex, [this, name, fieldOrSpec, options, callback]);\n}, 'Db.ensureIndex is deprecated as of MongoDB version 3.0 / driver version 2.0');\n\nDb.prototype.addChild = function (db) {\n  if (this.s.parentDb) return this.s.parentDb.addChild(db);\n  this.s.children.push(db);\n};\n/**\r\n * Add a user to the database.\r\n * @method\r\n * @param {string} username The username.\r\n * @param {string} password The password.\r\n * @param {object} [options] Optional settings.\r\n * @param {(number|string)} [options.w] **Deprecated** The write concern. Use writeConcern instead.\r\n * @param {number} [options.wtimeout] **Deprecated** The write concern timeout. Use writeConcern instead.\r\n * @param {boolean} [options.j=false] **Deprecated** Specify a journal write concern. Use writeConcern instead.\r\n * @param {object|WriteConcern} [options.writeConcern] Specify write concern settings.\r\n * @param {object} [options.customData] Custom data associated with the user (only Mongodb 2.6 or higher)\r\n * @param {object[]} [options.roles] Roles associated with the created user (only Mongodb 2.6 or higher)\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~resultCallback} [callback] The command result callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\n\n\nDb.prototype.addUser = function (username, password, options, callback) {\n  if (typeof options === 'function') callback = options, options = {};\n  options = options || {}; // Special case where there is no password ($external users)\n\n  if (typeof username === 'string' && password != null && typeof password === 'object') {\n    options = password;\n    password = null;\n  }\n\n  const addUserOperation = new AddUserOperation(this, username, password, options);\n  return executeOperation(this.s.topology, addUserOperation, callback);\n};\n/**\r\n * Remove a user from a database\r\n * @method\r\n * @param {string} username The username.\r\n * @param {object} [options] Optional settings.\r\n * @param {(number|string)} [options.w] **Deprecated** The write concern. Use writeConcern instead.\r\n * @param {number} [options.wtimeout] **Deprecated** The write concern timeout. Use writeConcern instead.\r\n * @param {boolean} [options.j=false] **Deprecated** Specify a journal write concern. Use writeConcern instead.\r\n * @param {object|WriteConcern} [options.writeConcern] Specify write concern settings.\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~resultCallback} [callback] The command result callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\n\n\nDb.prototype.removeUser = function (username, options, callback) {\n  if (typeof options === 'function') callback = options, options = {};\n  options = options || {};\n  const removeUserOperation = new RemoveUserOperation(this, username, options);\n  return executeOperation(this.s.topology, removeUserOperation, callback);\n};\n/**\r\n * Set the current profiling level of MongoDB\r\n *\r\n * @param {string} level The new profiling level (off, slow_only, all).\r\n * @param {Object} [options] Optional settings\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~resultCallback} [callback] The command result callback.\r\n * @return {Promise} returns Promise if no callback passed\r\n */\n\n\nDb.prototype.setProfilingLevel = function (level, options, callback) {\n  if (typeof options === 'function') callback = options, options = {};\n  options = options || {};\n  const setProfilingLevelOperation = new SetProfilingLevelOperation(this, level, options);\n  return executeOperation(this.s.topology, setProfilingLevelOperation, callback);\n};\n/**\r\n * Retrieve the current profiling information for MongoDB\r\n *\r\n * @param {Object} [options] Optional settings\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~resultCallback} [callback] The command result callback.\r\n * @return {Promise} returns Promise if no callback passed\r\n * @deprecated Query the system.profile collection directly.\r\n */\n\n\nDb.prototype.profilingInfo = deprecate(function (options, callback) {\n  if (typeof options === 'function') callback = options, options = {};\n  options = options || {};\n  return executeLegacyOperation(this.s.topology, profilingInfo, [this, options, callback]);\n}, 'Db.profilingInfo is deprecated. Query the system.profile collection directly.');\n/**\r\n * Retrieve the current profiling Level for MongoDB\r\n *\r\n * @param {Object} [options] Optional settings\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~resultCallback} [callback] The command result callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\n\nDb.prototype.profilingLevel = function (options, callback) {\n  if (typeof options === 'function') callback = options, options = {};\n  options = options || {};\n  const profilingLevelOperation = new ProfilingLevelOperation(this, options);\n  return executeOperation(this.s.topology, profilingLevelOperation, callback);\n};\n/**\r\n * Retrieves this collections index info.\r\n * @method\r\n * @param {string} name The name of the collection.\r\n * @param {object} [options] Optional settings.\r\n * @param {boolean} [options.full=false] Returns the full raw index information.\r\n * @param {(ReadPreference|string)} [options.readPreference] The preferred read preference (ReadPreference.PRIMARY, ReadPreference.PRIMARY_PREFERRED, ReadPreference.SECONDARY, ReadPreference.SECONDARY_PREFERRED, ReadPreference.NEAREST).\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~resultCallback} [callback] The command result callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\n\n\nDb.prototype.indexInformation = function (name, options, callback) {\n  if (typeof options === 'function') callback = options, options = {};\n  options = options || {};\n  const indexInformationOperation = new IndexInformationOperation(this, name, options);\n  return executeOperation(this.s.topology, indexInformationOperation, callback);\n};\n/**\r\n * Unref all sockets\r\n * @method\r\n */\n\n\nDb.prototype.unref = function () {\n  this.s.topology.unref();\n};\n/**\r\n * Create a new Change Stream, watching for new changes (insertions, updates, replacements, deletions, and invalidations) in this database. Will ignore all changes to system collections.\r\n * @method\r\n * @since 3.1.0\r\n * @param {Array} [pipeline] An array of {@link https://docs.mongodb.com/manual/reference/operator/aggregation-pipeline/|aggregation pipeline stages} through which to pass change stream documents. This allows for filtering (using $match) and manipulating the change stream documents.\r\n * @param {object} [options] Optional settings\r\n * @param {string} [options.fullDocument='default'] Allowed values: ‘default’, ‘updateLookup’. When set to ‘updateLookup’, the change stream will include both a delta describing the changes to the document, as well as a copy of the entire document that was changed from some time after the change occurred.\r\n * @param {object} [options.resumeAfter] Specifies the logical starting point for the new change stream. This should be the _id field from a previously returned change stream document.\r\n * @param {number} [options.maxAwaitTimeMS] The maximum amount of time for the server to wait on new documents to satisfy a change stream query\r\n * @param {number} [options.batchSize=1000] The number of documents to return per batch. See {@link https://docs.mongodb.com/manual/reference/command/aggregate|aggregation documentation}.\r\n * @param {object} [options.collation] Specify collation settings for operation. See {@link https://docs.mongodb.com/manual/reference/command/aggregate|aggregation documentation}.\r\n * @param {ReadPreference} [options.readPreference] The read preference. Defaults to the read preference of the database. See {@link https://docs.mongodb.com/manual/reference/read-preference|read preference documentation}.\r\n * @param {Timestamp} [options.startAtOperationTime] receive change events that occur after the specified timestamp\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @return {ChangeStream} a ChangeStream instance.\r\n */\n\n\nDb.prototype.watch = function (pipeline, options) {\n  pipeline = pipeline || [];\n  options = options || {}; // Allow optionally not specifying a pipeline\n\n  if (!Array.isArray(pipeline)) {\n    options = pipeline;\n    pipeline = [];\n  }\n\n  return new ChangeStream(this, pipeline, options);\n};\n/**\r\n * Return the db logger\r\n * @method\r\n * @return {Logger} return the db logger\r\n * @ignore\r\n */\n\n\nDb.prototype.getLogger = function () {\n  return this.s.logger;\n};\n/**\r\n * Db close event\r\n *\r\n * Emitted after a socket closed against a single server or mongos proxy.\r\n *\r\n * @event Db#close\r\n * @type {MongoError}\r\n */\n\n/**\r\n * Db reconnect event\r\n *\r\n *  * Server: Emitted when the driver has reconnected and re-authenticated.\r\n *  * ReplicaSet: N/A\r\n *  * Mongos: Emitted when the driver reconnects and re-authenticates successfully against a Mongos.\r\n *\r\n * @event Db#reconnect\r\n * @type {object}\r\n */\n\n/**\r\n * Db error event\r\n *\r\n * Emitted after an error occurred against a single server or mongos proxy.\r\n *\r\n * @event Db#error\r\n * @type {MongoError}\r\n */\n\n/**\r\n * Db timeout event\r\n *\r\n * Emitted after a socket timeout occurred against a single server or mongos proxy.\r\n *\r\n * @event Db#timeout\r\n * @type {MongoError}\r\n */\n\n/**\r\n * Db parseError event\r\n *\r\n * The parseError event is emitted if the driver detects illegal or corrupt BSON being received from the server.\r\n *\r\n * @event Db#parseError\r\n * @type {MongoError}\r\n */\n\n/**\r\n * Db fullsetup event, emitted when all servers in the topology have been connected to at start up time.\r\n *\r\n * * Server: Emitted when the driver has connected to the single server and has authenticated.\r\n * * ReplSet: Emitted after the driver has attempted to connect to all replicaset members.\r\n * * Mongos: Emitted after the driver has attempted to connect to all mongos proxies.\r\n *\r\n * @event Db#fullsetup\r\n * @type {Db}\r\n */\n// Constants\n\n\nDb.SYSTEM_NAMESPACE_COLLECTION = CONSTANTS.SYSTEM_NAMESPACE_COLLECTION;\nDb.SYSTEM_INDEX_COLLECTION = CONSTANTS.SYSTEM_INDEX_COLLECTION;\nDb.SYSTEM_PROFILE_COLLECTION = CONSTANTS.SYSTEM_PROFILE_COLLECTION;\nDb.SYSTEM_USER_COLLECTION = CONSTANTS.SYSTEM_USER_COLLECTION;\nDb.SYSTEM_COMMAND_COLLECTION = CONSTANTS.SYSTEM_COMMAND_COLLECTION;\nDb.SYSTEM_JS_COLLECTION = CONSTANTS.SYSTEM_JS_COLLECTION;\nmodule.exports = Db;","map":{"version":3,"sources":["C:/Users/Tanja Aakerholt/Documents/GitHub/portfolio2/client/node_modules/mongodb/lib/db.js"],"names":["EventEmitter","require","inherits","getSingleProperty","CommandCursor","handleCallback","filterOptions","toError","ReadPreference","MongoError","ObjectID","Logger","Collection","conditionallyMergeWriteConcern","executeLegacyOperation","ChangeStream","deprecate","deprecateOptions","MongoDBNamespace","CONSTANTS","WriteConcern","ReadConcern","AggregationCursor","createListener","ensureIndex","evaluate","profilingInfo","validateDatabaseName","AggregateOperation","AddUserOperation","CollectionsOperation","CommandOperation","RunCommandOperation","CreateCollectionOperation","CreateIndexesOperation","DropCollectionOperation","DropDatabaseOperation","ExecuteDbAdminCommandOperation","IndexInformationOperation","ListCollectionsOperation","ProfilingLevelOperation","RemoveUserOperation","RenameOperation","SetProfilingLevelOperation","executeOperation","legalOptionNames","Db","databaseName","topology","options","call","promiseLibrary","Promise","s","dbCache","children","logger","bson","readPreference","fromOptions","bufferMaxEntries","parentDb","pkFactory","nativeParser","native_parser","noListener","readConcern","writeConcern","namespace","db","on","once","prototype","super_","apply","arguments","Object","defineProperty","enumerable","get","mode","primary","toString","command","callback","assign","commandOperation","aggregate","pipeline","cursor","admin","Admin","COLLECTION_OPTION_KEYS","collection","name","level","ignoreUndefined","collectionOptionKey","undefined","strict","err","serverConfig","isDestroyed","listCollectionOptions","nameOnly","listCollections","toArray","collections","length","createCollection","deprecatedOptions","optionsIndex","createCollectionOperation","stats","commandObject","dbStats","statsOperation","filter","eval","code","parameters","args","Array","slice","pop","shift","renameCollection","fromCollection","toCollection","PRIMARY","new_collection","renameOperation","dropCollection","dropCollectionOperation","dropDatabase","dropDatabaseOperation","collectionsOperation","executeDbAdminCommand","selector","resolve","executeDbAdminCommandOperation","createIndex","fieldOrSpec","createIndexesOperation","addChild","push","addUser","username","password","addUserOperation","removeUser","removeUserOperation","setProfilingLevel","setProfilingLevelOperation","profilingLevel","profilingLevelOperation","indexInformation","indexInformationOperation","unref","watch","isArray","getLogger","SYSTEM_NAMESPACE_COLLECTION","SYSTEM_INDEX_COLLECTION","SYSTEM_PROFILE_COLLECTION","SYSTEM_USER_COLLECTION","SYSTEM_COMMAND_COLLECTION","SYSTEM_JS_COLLECTION","module","exports"],"mappings":"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","sourcesContent":["'use strict';\r\n\r\nconst EventEmitter = require('events').EventEmitter;\r\nconst inherits = require('util').inherits;\r\nconst getSingleProperty = require('./utils').getSingleProperty;\r\nconst CommandCursor = require('./command_cursor');\r\nconst handleCallback = require('./utils').handleCallback;\r\nconst filterOptions = require('./utils').filterOptions;\r\nconst toError = require('./utils').toError;\r\nconst ReadPreference = require('./core').ReadPreference;\r\nconst MongoError = require('./core').MongoError;\r\nconst ObjectID = require('./core').ObjectID;\r\nconst Logger = require('./core').Logger;\r\nconst Collection = require('./collection');\r\nconst conditionallyMergeWriteConcern = require('./utils').conditionallyMergeWriteConcern;\r\nconst executeLegacyOperation = require('./utils').executeLegacyOperation;\r\nconst ChangeStream = require('./change_stream');\r\nconst deprecate = require('util').deprecate;\r\nconst deprecateOptions = require('./utils').deprecateOptions;\r\nconst MongoDBNamespace = require('./utils').MongoDBNamespace;\r\nconst CONSTANTS = require('./constants');\r\nconst WriteConcern = require('./write_concern');\r\nconst ReadConcern = require('./read_concern');\r\nconst AggregationCursor = require('./aggregation_cursor');\r\n\r\n// Operations\r\nconst createListener = require('./operations/db_ops').createListener;\r\nconst ensureIndex = require('./operations/db_ops').ensureIndex;\r\nconst evaluate = require('./operations/db_ops').evaluate;\r\nconst profilingInfo = require('./operations/db_ops').profilingInfo;\r\nconst validateDatabaseName = require('./operations/db_ops').validateDatabaseName;\r\n\r\nconst AggregateOperation = require('./operations/aggregate');\r\nconst AddUserOperation = require('./operations/add_user');\r\nconst CollectionsOperation = require('./operations/collections');\r\nconst CommandOperation = require('./operations/command');\r\nconst RunCommandOperation = require('./operations/run_command');\r\nconst CreateCollectionOperation = require('./operations/create_collection');\r\nconst CreateIndexesOperation = require('./operations/create_indexes');\r\nconst DropCollectionOperation = require('./operations/drop').DropCollectionOperation;\r\nconst DropDatabaseOperation = require('./operations/drop').DropDatabaseOperation;\r\nconst ExecuteDbAdminCommandOperation = require('./operations/execute_db_admin_command');\r\nconst IndexInformationOperation = require('./operations/index_information');\r\nconst ListCollectionsOperation = require('./operations/list_collections');\r\nconst ProfilingLevelOperation = require('./operations/profiling_level');\r\nconst RemoveUserOperation = require('./operations/remove_user');\r\nconst RenameOperation = require('./operations/rename');\r\nconst SetProfilingLevelOperation = require('./operations/set_profiling_level');\r\n\r\nconst executeOperation = require('./operations/execute_operation');\r\n\r\n/**\r\n * @fileOverview The **Db** class is a class that represents a MongoDB Database.\r\n *\r\n * @example\r\n * const MongoClient = require('mongodb').MongoClient;\r\n * // Connection url\r\n * const url = 'mongodb://localhost:27017';\r\n * // Database Name\r\n * const dbName = 'test';\r\n * // Connect using MongoClient\r\n * MongoClient.connect(url, function(err, client) {\r\n *   // Select the database by name\r\n *   const testDb = client.db(dbName);\r\n *   client.close();\r\n * });\r\n */\r\n\r\n// Allowed parameters\r\nconst legalOptionNames = [\r\n  'w',\r\n  'wtimeout',\r\n  'fsync',\r\n  'j',\r\n  'writeConcern',\r\n  'readPreference',\r\n  'readPreferenceTags',\r\n  'native_parser',\r\n  'forceServerObjectId',\r\n  'pkFactory',\r\n  'serializeFunctions',\r\n  'raw',\r\n  'bufferMaxEntries',\r\n  'authSource',\r\n  'ignoreUndefined',\r\n  'promoteLongs',\r\n  'promiseLibrary',\r\n  'readConcern',\r\n  'retryMiliSeconds',\r\n  'numberOfRetries',\r\n  'parentDb',\r\n  'noListener',\r\n  'loggerLevel',\r\n  'logger',\r\n  'promoteBuffers',\r\n  'promoteLongs',\r\n  'promoteValues',\r\n  'compression',\r\n  'retryWrites'\r\n];\r\n\r\n/**\r\n * Creates a new Db instance\r\n * @class\r\n * @param {string} databaseName The name of the database this instance represents.\r\n * @param {(Server|ReplSet|Mongos)} topology The server topology for the database.\r\n * @param {object} [options] Optional settings.\r\n * @param {string} [options.authSource] If the database authentication is dependent on another databaseName.\r\n * @param {(number|string)} [options.w] **Deprecated** The write concern. Use writeConcern instead.\r\n * @param {number} [options.wtimeout] **Deprecated** The write concern timeout. Use writeConcern instead.\r\n * @param {boolean} [options.j=false] **Deprecated** Specify a journal write concern. Use writeConcern instead.\r\n * @param {object|WriteConcern} [options.writeConcern] Specify write concern settings.\r\n * @param {boolean} [options.forceServerObjectId=false] Force server to assign _id values instead of driver.\r\n * @param {boolean} [options.serializeFunctions=false] Serialize functions on any object.\r\n * @param {Boolean} [options.ignoreUndefined=false] Specify if the BSON serializer should ignore undefined fields.\r\n * @param {boolean} [options.raw=false] Return document results as raw BSON buffers.\r\n * @param {boolean} [options.promoteLongs=true] Promotes Long values to number if they fit inside the 53 bits resolution.\r\n * @param {boolean} [options.promoteBuffers=false] Promotes Binary BSON values to native Node Buffers.\r\n * @param {boolean} [options.promoteValues=true] Promotes BSON values to native types where possible, set to false to only receive wrapper types.\r\n * @param {number} [options.bufferMaxEntries=-1] Sets a cap on how many operations the driver will buffer up before giving up on getting a working connection, default is -1 which is unlimited.\r\n * @param {(ReadPreference|string)} [options.readPreference] The preferred read preference (ReadPreference.PRIMARY, ReadPreference.PRIMARY_PREFERRED, ReadPreference.SECONDARY, ReadPreference.SECONDARY_PREFERRED, ReadPreference.NEAREST).\r\n * @param {object} [options.pkFactory] A primary key factory object for generation of custom _id keys.\r\n * @param {object} [options.promiseLibrary] A Promise library class the application wishes to use such as Bluebird, must be ES6 compatible\r\n * @param {object} [options.readConcern] Specify a read concern for the collection. (only MongoDB 3.2 or higher supported)\r\n * @param {ReadConcernLevel} [options.readConcern.level='local'] Specify a read concern level for the collection operations (only MongoDB 3.2 or higher supported)\r\n * @property {(Server|ReplSet|Mongos)} serverConfig Get the current db topology.\r\n * @property {number} bufferMaxEntries Current bufferMaxEntries value for the database\r\n * @property {string} databaseName The name of the database this instance represents.\r\n * @property {object} options The options associated with the db instance.\r\n * @property {boolean} native_parser The current value of the parameter native_parser.\r\n * @property {boolean} slaveOk The current slaveOk value for the db instance.\r\n * @property {object} writeConcern The current write concern values.\r\n * @property {object} topology Access the topology object (single server, replicaset or mongos).\r\n * @fires Db#close\r\n * @fires Db#reconnect\r\n * @fires Db#error\r\n * @fires Db#timeout\r\n * @fires Db#parseError\r\n * @fires Db#fullsetup\r\n * @return {Db} a Db instance.\r\n */\r\nfunction Db(databaseName, topology, options) {\r\n  options = options || {};\r\n  if (!(this instanceof Db)) return new Db(databaseName, topology, options);\r\n  EventEmitter.call(this);\r\n\r\n  // Get the promiseLibrary\r\n  const promiseLibrary = options.promiseLibrary || Promise;\r\n\r\n  // Filter the options\r\n  options = filterOptions(options, legalOptionNames);\r\n\r\n  // Ensure we put the promiseLib in the options\r\n  options.promiseLibrary = promiseLibrary;\r\n\r\n  // Internal state of the db object\r\n  this.s = {\r\n    // DbCache\r\n    dbCache: {},\r\n    // Children db's\r\n    children: [],\r\n    // Topology\r\n    topology: topology,\r\n    // Options\r\n    options: options,\r\n    // Logger instance\r\n    logger: Logger('Db', options),\r\n    // Get the bson parser\r\n    bson: topology ? topology.bson : null,\r\n    // Unpack read preference\r\n    readPreference: ReadPreference.fromOptions(options),\r\n    // Set buffermaxEntries\r\n    bufferMaxEntries: typeof options.bufferMaxEntries === 'number' ? options.bufferMaxEntries : -1,\r\n    // Parent db (if chained)\r\n    parentDb: options.parentDb || null,\r\n    // Set up the primary key factory or fallback to ObjectID\r\n    pkFactory: options.pkFactory || ObjectID,\r\n    // Get native parser\r\n    nativeParser: options.nativeParser || options.native_parser,\r\n    // Promise library\r\n    promiseLibrary: promiseLibrary,\r\n    // No listener\r\n    noListener: typeof options.noListener === 'boolean' ? options.noListener : false,\r\n    // ReadConcern\r\n    readConcern: ReadConcern.fromOptions(options),\r\n    writeConcern: WriteConcern.fromOptions(options),\r\n    // Namespace\r\n    namespace: new MongoDBNamespace(databaseName)\r\n  };\r\n\r\n  // Ensure we have a valid db name\r\n  validateDatabaseName(databaseName);\r\n\r\n  // Add a read Only property\r\n  getSingleProperty(this, 'serverConfig', this.s.topology);\r\n  getSingleProperty(this, 'bufferMaxEntries', this.s.bufferMaxEntries);\r\n  getSingleProperty(this, 'databaseName', this.s.namespace.db);\r\n\r\n  // This is a child db, do not register any listeners\r\n  if (options.parentDb) return;\r\n  if (this.s.noListener) return;\r\n\r\n  // Add listeners\r\n  topology.on('error', createListener(this, 'error', this));\r\n  topology.on('timeout', createListener(this, 'timeout', this));\r\n  topology.on('close', createListener(this, 'close', this));\r\n  topology.on('parseError', createListener(this, 'parseError', this));\r\n  topology.once('open', createListener(this, 'open', this));\r\n  topology.once('fullsetup', createListener(this, 'fullsetup', this));\r\n  topology.once('all', createListener(this, 'all', this));\r\n  topology.on('reconnect', createListener(this, 'reconnect', this));\r\n}\r\n\r\ninherits(Db, EventEmitter);\r\n\r\nDb.prototype.on = deprecate(function() {\r\n  return Db.super_.prototype.on.apply(this, arguments);\r\n}, 'Listening to events on the Db class has been deprecated and will be removed in the next major version.');\r\n\r\nDb.prototype.once = deprecate(function() {\r\n  return Db.super_.prototype.once.apply(this, arguments);\r\n}, 'Listening to events on the Db class has been deprecated and will be removed in the next major version.');\r\n\r\n// Topology\r\nObject.defineProperty(Db.prototype, 'topology', {\r\n  enumerable: true,\r\n  get: function() {\r\n    return this.s.topology;\r\n  }\r\n});\r\n\r\n// Options\r\nObject.defineProperty(Db.prototype, 'options', {\r\n  enumerable: true,\r\n  get: function() {\r\n    return this.s.options;\r\n  }\r\n});\r\n\r\n// slaveOk specified\r\nObject.defineProperty(Db.prototype, 'slaveOk', {\r\n  enumerable: true,\r\n  get: function() {\r\n    if (\r\n      this.s.options.readPreference != null &&\r\n      (this.s.options.readPreference !== 'primary' ||\r\n        this.s.options.readPreference.mode !== 'primary')\r\n    ) {\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n});\r\n\r\nObject.defineProperty(Db.prototype, 'readConcern', {\r\n  enumerable: true,\r\n  get: function() {\r\n    return this.s.readConcern;\r\n  }\r\n});\r\n\r\nObject.defineProperty(Db.prototype, 'readPreference', {\r\n  enumerable: true,\r\n  get: function() {\r\n    if (this.s.readPreference == null) {\r\n      // TODO: check client\r\n      return ReadPreference.primary;\r\n    }\r\n\r\n    return this.s.readPreference;\r\n  }\r\n});\r\n\r\n// get the write Concern\r\nObject.defineProperty(Db.prototype, 'writeConcern', {\r\n  enumerable: true,\r\n  get: function() {\r\n    return this.s.writeConcern;\r\n  }\r\n});\r\n\r\nObject.defineProperty(Db.prototype, 'namespace', {\r\n  enumerable: true,\r\n  get: function() {\r\n    return this.s.namespace.toString();\r\n  }\r\n});\r\n\r\n/**\r\n * Execute a command\r\n * @method\r\n * @param {object} command The command hash\r\n * @param {object} [options] Optional settings.\r\n * @param {(ReadPreference|string)} [options.readPreference] The preferred read preference (ReadPreference.PRIMARY, ReadPreference.PRIMARY_PREFERRED, ReadPreference.SECONDARY, ReadPreference.SECONDARY_PREFERRED, ReadPreference.NEAREST).\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~resultCallback} [callback] The command result callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\r\nDb.prototype.command = function(command, options, callback) {\r\n  if (typeof options === 'function') (callback = options), (options = {});\r\n  options = Object.assign({}, options);\r\n\r\n  const commandOperation = new RunCommandOperation(this, command, options);\r\n\r\n  return executeOperation(this.s.topology, commandOperation, callback);\r\n};\r\n\r\n/**\r\n * Execute an aggregation framework pipeline against the database, needs MongoDB >= 3.6\r\n * @method\r\n * @param {object} [pipeline=[]] Array containing all the aggregation framework commands for the execution.\r\n * @param {object} [options] Optional settings.\r\n * @param {(ReadPreference|string)} [options.readPreference] The preferred read preference (ReadPreference.PRIMARY, ReadPreference.PRIMARY_PREFERRED, ReadPreference.SECONDARY, ReadPreference.SECONDARY_PREFERRED, ReadPreference.NEAREST).\r\n * @param {number} [options.batchSize=1000] The number of documents to return per batch. See {@link https://docs.mongodb.com/manual/reference/command/aggregate|aggregation documentation}.\r\n * @param {object} [options.cursor] Return the query as cursor, on 2.6 > it returns as a real cursor on pre 2.6 it returns as an emulated cursor.\r\n * @param {number} [options.cursor.batchSize=1000] Deprecated. Use `options.batchSize`\r\n * @param {'queryPlanner'|'queryPlannerExtended'|'executionStats'|'allPlansExecution'|boolean} [options.explain] The verbosity mode for the explain output.\r\n * @param {boolean} [options.allowDiskUse=false] allowDiskUse lets the server know if it can use disk to store temporary results for the aggregation (requires mongodb 2.6 >).\r\n * @param {number} [options.maxTimeMS] maxTimeMS specifies a cumulative time limit in milliseconds for processing operations on the cursor. MongoDB interrupts the operation at the earliest following interrupt point.\r\n * @param {number} [options.maxAwaitTimeMS] The maximum amount of time for the server to wait on new documents to satisfy a tailable cursor query.\r\n * @param {boolean} [options.bypassDocumentValidation=false] Allow driver to bypass schema validation in MongoDB 3.2 or higher.\r\n * @param {boolean} [options.raw=false] Return document results as raw BSON buffers.\r\n * @param {boolean} [options.promoteLongs=true] Promotes Long values to number if they fit inside the 53 bits resolution.\r\n * @param {boolean} [options.promoteValues=true] Promotes BSON values to native types where possible, set to false to only receive wrapper types.\r\n * @param {boolean} [options.promoteBuffers=false] Promotes Binary BSON values to native Node Buffers.\r\n * @param {object} [options.collation] Specify collation (MongoDB 3.4 or higher) settings for update operation (see 3.4 documentation for available fields).\r\n * @param {string} [options.comment] Add a comment to an aggregation command\r\n * @param {string|object} [options.hint] Add an index selection hint to an aggregation command\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Database~aggregationCallback} callback The command result callback\r\n * @return {(null|AggregationCursor)}\r\n */\r\nDb.prototype.aggregate = function(pipeline, options, callback) {\r\n  if (typeof options === 'function') {\r\n    callback = options;\r\n    options = {};\r\n  }\r\n\r\n  // If we have no options or callback we are doing\r\n  // a cursor based aggregation\r\n  if (options == null && callback == null) {\r\n    options = {};\r\n  }\r\n\r\n  const cursor = new AggregationCursor(\r\n    this.s.topology,\r\n    new AggregateOperation(this, pipeline, options),\r\n    options\r\n  );\r\n\r\n  // TODO: remove this when NODE-2074 is resolved\r\n  if (typeof callback === 'function') {\r\n    callback(null, cursor);\r\n    return;\r\n  }\r\n\r\n  return cursor;\r\n};\r\n\r\n/**\r\n * Return the Admin db instance\r\n * @method\r\n * @return {Admin} return the new Admin db instance\r\n */\r\nDb.prototype.admin = function() {\r\n  const Admin = require('./admin');\r\n\r\n  return new Admin(this, this.s.topology, this.s.promiseLibrary);\r\n};\r\n\r\n/**\r\n * The callback format for the collection method, must be used if strict is specified\r\n * @callback Db~collectionResultCallback\r\n * @param {MongoError} error An error instance representing the error during the execution.\r\n * @param {Collection} collection The collection instance.\r\n */\r\n\r\n/**\r\n * The callback format for an aggregation call\r\n * @callback Database~aggregationCallback\r\n * @param {MongoError} error An error instance representing the error during the execution.\r\n * @param {AggregationCursor} cursor The cursor if the aggregation command was executed successfully.\r\n */\r\n\r\nconst COLLECTION_OPTION_KEYS = [\r\n  'pkFactory',\r\n  'readPreference',\r\n  'serializeFunctions',\r\n  'strict',\r\n  'readConcern',\r\n  'ignoreUndefined',\r\n  'promoteValues',\r\n  'promoteBuffers',\r\n  'promoteLongs'\r\n];\r\n\r\n/**\r\n * Fetch a specific collection (containing the actual collection information). If the application does not use strict mode you\r\n * can use it without a callback in the following way: `const collection = db.collection('mycollection');`\r\n *\r\n * @method\r\n * @param {string} name the collection name we wish to access.\r\n * @param {object} [options] Optional settings.\r\n * @param {(number|string)} [options.w] **Deprecated** The write concern. Use writeConcern instead.\r\n * @param {number} [options.wtimeout] **Deprecated** The write concern timeout. Use writeConcern instead.\r\n * @param {boolean} [options.j=false] **Deprecated** Specify a journal write concern. Use writeConcern instead.\r\n * @param {object|WriteConcern} [options.writeConcern] Specify write concern settings.\r\n * @param {boolean} [options.raw=false] Return document results as raw BSON buffers.\r\n * @param {object} [options.pkFactory] A primary key factory object for generation of custom _id keys.\r\n * @param {(ReadPreference|string)} [options.readPreference] The preferred read preference (ReadPreference.PRIMARY, ReadPreference.PRIMARY_PREFERRED, ReadPreference.SECONDARY, ReadPreference.SECONDARY_PREFERRED, ReadPreference.NEAREST).\r\n * @param {boolean} [options.serializeFunctions=false] Serialize functions on any object.\r\n * @param {boolean} [options.strict=false] Returns an error if the collection does not exist\r\n * @param {object} [options.readConcern] Specify a read concern for the collection. (only MongoDB 3.2 or higher supported)\r\n * @param {ReadConcernLevel} [options.readConcern.level='local'] Specify a read concern level for the collection operations (only MongoDB 3.2 or higher supported)\r\n * @param {Db~collectionResultCallback} [callback] The collection result callback\r\n * @return {Collection} return the new Collection instance if not in strict mode\r\n */\r\nDb.prototype.collection = function(name, options, callback) {\r\n  if (typeof options === 'function') (callback = options), (options = {});\r\n  options = options || {};\r\n  options = Object.assign({}, options);\r\n\r\n  // Set the promise library\r\n  options.promiseLibrary = this.s.promiseLibrary;\r\n\r\n  // If we have not set a collection level readConcern set the db level one\r\n  options.readConcern = options.readConcern\r\n    ? new ReadConcern(options.readConcern.level)\r\n    : this.readConcern;\r\n\r\n  // Do we have ignoreUndefined set\r\n  if (this.s.options.ignoreUndefined) {\r\n    options.ignoreUndefined = this.s.options.ignoreUndefined;\r\n  }\r\n\r\n  for (const collectionOptionKey of COLLECTION_OPTION_KEYS) {\r\n    if (!(collectionOptionKey in options) && this.s.options[collectionOptionKey] !== undefined) {\r\n      options[collectionOptionKey] = this.s.options[collectionOptionKey];\r\n    }\r\n  }\r\n\r\n  // Merge in all needed options and ensure correct writeConcern merging from db level\r\n  options = conditionallyMergeWriteConcern(options, this.s.options);\r\n\r\n  // Execute\r\n  if (options == null || !options.strict) {\r\n    try {\r\n      const collection = new Collection(\r\n        this,\r\n        this.s.topology,\r\n        this.databaseName,\r\n        name,\r\n        this.s.pkFactory,\r\n        options\r\n      );\r\n      if (callback) callback(null, collection);\r\n      return collection;\r\n    } catch (err) {\r\n      if (err instanceof MongoError && callback) return callback(err);\r\n      throw err;\r\n    }\r\n  }\r\n\r\n  // Strict mode\r\n  if (typeof callback !== 'function') {\r\n    throw toError(`A callback is required in strict mode. While getting collection ${name}`);\r\n  }\r\n\r\n  // Did the user destroy the topology\r\n  if (this.serverConfig && this.serverConfig.isDestroyed()) {\r\n    return callback(new MongoError('topology was destroyed'));\r\n  }\r\n\r\n  const listCollectionOptions = Object.assign({}, options, { nameOnly: true });\r\n\r\n  // Strict mode\r\n  this.listCollections({ name: name }, listCollectionOptions).toArray((err, collections) => {\r\n    if (err != null) return handleCallback(callback, err, null);\r\n    if (collections.length === 0)\r\n      return handleCallback(\r\n        callback,\r\n        toError(`Collection ${name} does not exist. Currently in strict mode.`),\r\n        null\r\n      );\r\n\r\n    try {\r\n      return handleCallback(\r\n        callback,\r\n        null,\r\n        new Collection(this, this.s.topology, this.databaseName, name, this.s.pkFactory, options)\r\n      );\r\n    } catch (err) {\r\n      return handleCallback(callback, err, null);\r\n    }\r\n  });\r\n};\r\n\r\n/**\r\n * Create a new collection on a server with the specified options. Use this to create capped collections.\r\n * More information about command options available at https://docs.mongodb.com/manual/reference/command/create/\r\n *\r\n * @method\r\n * @param {string} name the collection name we wish to access.\r\n * @param {object} [options] Optional settings.\r\n * @param {(number|string)} [options.w] **Deprecated** The write concern. Use writeConcern instead.\r\n * @param {number} [options.wtimeout] **Deprecated** The write concern timeout. Use writeConcern instead.\r\n * @param {boolean} [options.j=false] **Deprecated** Specify a journal write concern. Use writeConcern instead.\r\n * @param {object|WriteConcern} [options.writeConcern] Specify write concern settings.\r\n * @param {boolean} [options.raw=false] Return document results as raw BSON buffers.\r\n * @param {object} [options.pkFactory] A primary key factory object for generation of custom _id keys.\r\n * @param {(ReadPreference|string)} [options.readPreference] The preferred read preference (ReadPreference.PRIMARY, ReadPreference.PRIMARY_PREFERRED, ReadPreference.SECONDARY, ReadPreference.SECONDARY_PREFERRED, ReadPreference.NEAREST).\r\n * @param {boolean} [options.serializeFunctions=false] Serialize functions on any object.\r\n * @param {boolean} [options.strict=false] DEPRECATED: Returns an error if the collection does not exist\r\n * @param {boolean} [options.capped=false] Create a capped collection.\r\n * @param {boolean} [options.autoIndexId=true] DEPRECATED: Create an index on the _id field of the document, True by default on MongoDB 2.6 - 3.0\r\n * @param {number} [options.size] The size of the capped collection in bytes.\r\n * @param {number} [options.max] The maximum number of documents in the capped collection.\r\n * @param {number} [options.flags] Optional. Available for the MMAPv1 storage engine only to set the usePowerOf2Sizes and the noPadding flag.\r\n * @param {object} [options.storageEngine] Allows users to specify configuration to the storage engine on a per-collection basis when creating a collection on MongoDB 3.0 or higher.\r\n * @param {object} [options.validator] Allows users to specify validation rules or expressions for the collection. For more information, see Document Validation on MongoDB 3.2 or higher.\r\n * @param {string} [options.validationLevel] Determines how strictly MongoDB applies the validation rules to existing documents during an update on MongoDB 3.2 or higher.\r\n * @param {string} [options.validationAction] Determines whether to error on invalid documents or just warn about the violations but allow invalid documents to be inserted on MongoDB 3.2 or higher.\r\n * @param {object} [options.indexOptionDefaults] Allows users to specify a default configuration for indexes when creating a collection on MongoDB 3.2 or higher.\r\n * @param {string} [options.viewOn] The name of the source collection or view from which to create the view. The name is not the full namespace of the collection or view; i.e. does not include the database name and implies the same database as the view to create on MongoDB 3.4 or higher.\r\n * @param {array} [options.pipeline] An array that consists of the aggregation pipeline stage. Creates the view by applying the specified pipeline to the viewOn collection or view on MongoDB 3.4 or higher.\r\n * @param {object} [options.collation] Specify collation (MongoDB 3.4 or higher) settings for update operation (see 3.4 documentation for available fields).\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~collectionResultCallback} [callback] The results callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\r\nDb.prototype.createCollection = deprecateOptions(\r\n  {\r\n    name: 'Db.createCollection',\r\n    deprecatedOptions: ['autoIndexId', 'strict', 'w', 'wtimeout', 'j'],\r\n    optionsIndex: 1\r\n  },\r\n  function(name, options, callback) {\r\n    if (typeof options === 'function') (callback = options), (options = {});\r\n    options = options || {};\r\n    options.promiseLibrary = options.promiseLibrary || this.s.promiseLibrary;\r\n    options.readConcern = options.readConcern\r\n      ? new ReadConcern(options.readConcern.level)\r\n      : this.readConcern;\r\n    const createCollectionOperation = new CreateCollectionOperation(this, name, options);\r\n\r\n    return executeOperation(this.s.topology, createCollectionOperation, callback);\r\n  }\r\n);\r\n\r\n/**\r\n * Get all the db statistics.\r\n *\r\n * @method\r\n * @param {object} [options] Optional settings.\r\n * @param {number} [options.scale] Divide the returned sizes by scale value.\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~resultCallback} [callback] The collection result callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\r\nDb.prototype.stats = function(options, callback) {\r\n  if (typeof options === 'function') (callback = options), (options = {});\r\n  options = options || {};\r\n  // Build command object\r\n  const commandObject = { dbStats: true };\r\n  // Check if we have the scale value\r\n  if (options['scale'] != null) commandObject['scale'] = options['scale'];\r\n\r\n  // If we have a readPreference set\r\n  if (options.readPreference == null && this.s.readPreference) {\r\n    options.readPreference = this.s.readPreference;\r\n  }\r\n\r\n  const statsOperation = new CommandOperation(this, options, null, commandObject);\r\n\r\n  // Execute the command\r\n  return executeOperation(this.s.topology, statsOperation, callback);\r\n};\r\n\r\n/**\r\n * Get the list of all collection information for the specified db.\r\n *\r\n * @method\r\n * @param {object} [filter={}] Query to filter collections by\r\n * @param {object} [options] Optional settings.\r\n * @param {boolean} [options.nameOnly=false] Since 4.0: If true, will only return the collection name in the response, and will omit additional info\r\n * @param {number} [options.batchSize=1000] The batchSize for the returned command cursor or if pre 2.8 the systems batch collection\r\n * @param {(ReadPreference|string)} [options.readPreference] The preferred read preference (ReadPreference.PRIMARY, ReadPreference.PRIMARY_PREFERRED, ReadPreference.SECONDARY, ReadPreference.SECONDARY_PREFERRED, ReadPreference.NEAREST).\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @return {CommandCursor}\r\n */\r\nDb.prototype.listCollections = function(filter, options) {\r\n  filter = filter || {};\r\n  options = options || {};\r\n\r\n  return new CommandCursor(\r\n    this.s.topology,\r\n    new ListCollectionsOperation(this, filter, options),\r\n    options\r\n  );\r\n};\r\n\r\n/**\r\n * Evaluate JavaScript on the server\r\n *\r\n * @method\r\n * @param {Code} code JavaScript to execute on server.\r\n * @param {(object|array)} parameters The parameters for the call.\r\n * @param {object} [options] Optional settings.\r\n * @param {boolean} [options.nolock=false] Tell MongoDB not to block on the evaluation of the javascript.\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~resultCallback} [callback] The results callback\r\n * @deprecated Eval is deprecated on MongoDB 3.2 and forward\r\n * @return {Promise} returns Promise if no callback passed\r\n */\r\nDb.prototype.eval = deprecate(function(code, parameters, options, callback) {\r\n  const args = Array.prototype.slice.call(arguments, 1);\r\n  callback = typeof args[args.length - 1] === 'function' ? args.pop() : undefined;\r\n  parameters = args.length ? args.shift() : parameters;\r\n  options = args.length ? args.shift() || {} : {};\r\n\r\n  return executeLegacyOperation(this.s.topology, evaluate, [\r\n    this,\r\n    code,\r\n    parameters,\r\n    options,\r\n    callback\r\n  ]);\r\n}, 'Db.eval is deprecated as of MongoDB version 3.2');\r\n\r\n/**\r\n * Rename a collection.\r\n *\r\n * @method\r\n * @param {string} fromCollection Name of current collection to rename.\r\n * @param {string} toCollection New name of of the collection.\r\n * @param {object} [options] Optional settings.\r\n * @param {boolean} [options.dropTarget=false] Drop the target name collection if it previously exists.\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~collectionResultCallback} [callback] The results callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\r\nDb.prototype.renameCollection = function(fromCollection, toCollection, options, callback) {\r\n  if (typeof options === 'function') (callback = options), (options = {});\r\n  options = Object.assign({}, options, { readPreference: ReadPreference.PRIMARY });\r\n\r\n  // Add return new collection\r\n  options.new_collection = true;\r\n\r\n  const renameOperation = new RenameOperation(\r\n    this.collection(fromCollection),\r\n    toCollection,\r\n    options\r\n  );\r\n\r\n  return executeOperation(this.s.topology, renameOperation, callback);\r\n};\r\n\r\n/**\r\n * Drop a collection from the database, removing it permanently. New accesses will create a new collection.\r\n *\r\n * @method\r\n * @param {string} name Name of collection to drop\r\n * @param {Object} [options] Optional settings\r\n * @param {(number|string)} [options.w] **Deprecated** The write concern. Use writeConcern instead.\r\n * @param {number} [options.wtimeout] **Deprecated** The write concern timeout. Use writeConcern instead.\r\n * @param {boolean} [options.j=false] **Deprecated** Specify a journal write concern. Use writeConcern instead.\r\n * @param {object|WriteConcern} [options.writeConcern] Specify write concern settings.\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~resultCallback} [callback] The results callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\r\nDb.prototype.dropCollection = function(name, options, callback) {\r\n  if (typeof options === 'function') (callback = options), (options = {});\r\n  options = options || {};\r\n\r\n  const dropCollectionOperation = new DropCollectionOperation(this, name, options);\r\n\r\n  return executeOperation(this.s.topology, dropCollectionOperation, callback);\r\n};\r\n\r\n/**\r\n * Drop a database, removing it permanently from the server.\r\n *\r\n * @method\r\n * @param {Object} [options] Optional settings\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~resultCallback} [callback] The results callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\r\nDb.prototype.dropDatabase = function(options, callback) {\r\n  if (typeof options === 'function') (callback = options), (options = {});\r\n  options = options || {};\r\n\r\n  const dropDatabaseOperation = new DropDatabaseOperation(this, options);\r\n\r\n  return executeOperation(this.s.topology, dropDatabaseOperation, callback);\r\n};\r\n\r\n/**\r\n * Fetch all collections for the current db.\r\n *\r\n * @method\r\n * @param {Object} [options] Optional settings\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~collectionsResultCallback} [callback] The results callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\r\nDb.prototype.collections = function(options, callback) {\r\n  if (typeof options === 'function') (callback = options), (options = {});\r\n  options = options || {};\r\n\r\n  const collectionsOperation = new CollectionsOperation(this, options);\r\n\r\n  return executeOperation(this.s.topology, collectionsOperation, callback);\r\n};\r\n\r\n/**\r\n * Runs a command on the database as admin.\r\n * @method\r\n * @param {object} command The command hash\r\n * @param {object} [options] Optional settings.\r\n * @param {(ReadPreference|string)} [options.readPreference] The preferred read preference (ReadPreference.PRIMARY, ReadPreference.PRIMARY_PREFERRED, ReadPreference.SECONDARY, ReadPreference.SECONDARY_PREFERRED, ReadPreference.NEAREST).\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~resultCallback} [callback] The command result callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\r\nDb.prototype.executeDbAdminCommand = function(selector, options, callback) {\r\n  if (typeof options === 'function') (callback = options), (options = {});\r\n  options = options || {};\r\n  options.readPreference = ReadPreference.resolve(this, options);\r\n\r\n  const executeDbAdminCommandOperation = new ExecuteDbAdminCommandOperation(\r\n    this,\r\n    selector,\r\n    options\r\n  );\r\n\r\n  return executeOperation(this.s.topology, executeDbAdminCommandOperation, callback);\r\n};\r\n\r\n/**\r\n * Creates an index on the db and collection.\r\n * @method\r\n * @param {string} name Name of the collection to create the index on.\r\n * @param {(string|object)} fieldOrSpec Defines the index.\r\n * @param {object} [options] Optional settings.\r\n * @param {(number|string)} [options.w] **Deprecated** The write concern. Use writeConcern instead.\r\n * @param {number} [options.wtimeout] **Deprecated** The write concern timeout. Use writeConcern instead.\r\n * @param {boolean} [options.j=false] **Deprecated** Specify a journal write concern. Use writeConcern instead.\r\n * @param {object|WriteConcern} [options.writeConcern] Specify write concern settings.\r\n * @param {boolean} [options.unique=false] Creates an unique index.\r\n * @param {boolean} [options.sparse=false] Creates a sparse index.\r\n * @param {boolean} [options.background=false] Creates the index in the background, yielding whenever possible.\r\n * @param {boolean} [options.dropDups=false] A unique index cannot be created on a key that has pre-existing duplicate values. If you would like to create the index anyway, keeping the first document the database indexes and deleting all subsequent documents that have duplicate value\r\n * @param {number} [options.min] For geospatial indexes set the lower bound for the co-ordinates.\r\n * @param {number} [options.max] For geospatial indexes set the high bound for the co-ordinates.\r\n * @param {number} [options.v] Specify the format version of the indexes.\r\n * @param {number} [options.expireAfterSeconds] Allows you to expire data on indexes applied to a data (MongoDB 2.2 or higher)\r\n * @param {string} [options.name] Override the autogenerated index name (useful if the resulting name is larger than 128 bytes)\r\n * @param {object} [options.partialFilterExpression] Creates a partial index based on the given filter object (MongoDB 3.2 or higher)\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {(number|string)} [options.commitQuorum] (MongoDB 4.4. or higher) Specifies how many data-bearing members of a replica set, including the primary, must complete the index builds successfully before the primary marks the indexes as ready. This option accepts the same values for the \"w\" field in a write concern plus \"votingMembers\", which indicates all voting data-bearing nodes.\r\n * @param {Db~resultCallback} [callback] The command result callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\r\nDb.prototype.createIndex = function(name, fieldOrSpec, options, callback) {\r\n  if (typeof options === 'function') (callback = options), (options = {});\r\n  options = options ? Object.assign({}, options) : {};\r\n\r\n  const createIndexesOperation = new CreateIndexesOperation(this, name, fieldOrSpec, options);\r\n\r\n  return executeOperation(this.s.topology, createIndexesOperation, callback);\r\n};\r\n\r\n/**\r\n * Ensures that an index exists, if it does not it creates it\r\n * @method\r\n * @deprecated since version 2.0\r\n * @param {string} name The index name\r\n * @param {(string|object)} fieldOrSpec Defines the index.\r\n * @param {object} [options] Optional settings.\r\n * @param {(number|string)} [options.w] **Deprecated** The write concern. Use writeConcern instead.\r\n * @param {number} [options.wtimeout] **Deprecated** The write concern timeout. Use writeConcern instead.\r\n * @param {boolean} [options.j=false] **Deprecated** Specify a journal write concern. Use writeConcern instead.\r\n * @param {object|WriteConcern} [options.writeConcern] Specify write concern settings.\r\n * @param {boolean} [options.unique=false] Creates an unique index.\r\n * @param {boolean} [options.sparse=false] Creates a sparse index.\r\n * @param {boolean} [options.background=false] Creates the index in the background, yielding whenever possible.\r\n * @param {boolean} [options.dropDups=false] A unique index cannot be created on a key that has pre-existing duplicate values. If you would like to create the index anyway, keeping the first document the database indexes and deleting all subsequent documents that have duplicate value\r\n * @param {number} [options.min] For geospatial indexes set the lower bound for the co-ordinates.\r\n * @param {number} [options.max] For geospatial indexes set the high bound for the co-ordinates.\r\n * @param {number} [options.v] Specify the format version of the indexes.\r\n * @param {number} [options.expireAfterSeconds] Allows you to expire data on indexes applied to a data (MongoDB 2.2 or higher)\r\n * @param {number} [options.name] Override the autogenerated index name (useful if the resulting name is larger than 128 bytes)\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~resultCallback} [callback] The command result callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\r\nDb.prototype.ensureIndex = deprecate(function(name, fieldOrSpec, options, callback) {\r\n  if (typeof options === 'function') (callback = options), (options = {});\r\n  options = options || {};\r\n\r\n  return executeLegacyOperation(this.s.topology, ensureIndex, [\r\n    this,\r\n    name,\r\n    fieldOrSpec,\r\n    options,\r\n    callback\r\n  ]);\r\n}, 'Db.ensureIndex is deprecated as of MongoDB version 3.0 / driver version 2.0');\r\n\r\nDb.prototype.addChild = function(db) {\r\n  if (this.s.parentDb) return this.s.parentDb.addChild(db);\r\n  this.s.children.push(db);\r\n};\r\n\r\n/**\r\n * Add a user to the database.\r\n * @method\r\n * @param {string} username The username.\r\n * @param {string} password The password.\r\n * @param {object} [options] Optional settings.\r\n * @param {(number|string)} [options.w] **Deprecated** The write concern. Use writeConcern instead.\r\n * @param {number} [options.wtimeout] **Deprecated** The write concern timeout. Use writeConcern instead.\r\n * @param {boolean} [options.j=false] **Deprecated** Specify a journal write concern. Use writeConcern instead.\r\n * @param {object|WriteConcern} [options.writeConcern] Specify write concern settings.\r\n * @param {object} [options.customData] Custom data associated with the user (only Mongodb 2.6 or higher)\r\n * @param {object[]} [options.roles] Roles associated with the created user (only Mongodb 2.6 or higher)\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~resultCallback} [callback] The command result callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\r\nDb.prototype.addUser = function(username, password, options, callback) {\r\n  if (typeof options === 'function') (callback = options), (options = {});\r\n  options = options || {};\r\n\r\n  // Special case where there is no password ($external users)\r\n  if (typeof username === 'string' && password != null && typeof password === 'object') {\r\n    options = password;\r\n    password = null;\r\n  }\r\n\r\n  const addUserOperation = new AddUserOperation(this, username, password, options);\r\n\r\n  return executeOperation(this.s.topology, addUserOperation, callback);\r\n};\r\n\r\n/**\r\n * Remove a user from a database\r\n * @method\r\n * @param {string} username The username.\r\n * @param {object} [options] Optional settings.\r\n * @param {(number|string)} [options.w] **Deprecated** The write concern. Use writeConcern instead.\r\n * @param {number} [options.wtimeout] **Deprecated** The write concern timeout. Use writeConcern instead.\r\n * @param {boolean} [options.j=false] **Deprecated** Specify a journal write concern. Use writeConcern instead.\r\n * @param {object|WriteConcern} [options.writeConcern] Specify write concern settings.\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~resultCallback} [callback] The command result callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\r\nDb.prototype.removeUser = function(username, options, callback) {\r\n  if (typeof options === 'function') (callback = options), (options = {});\r\n  options = options || {};\r\n\r\n  const removeUserOperation = new RemoveUserOperation(this, username, options);\r\n\r\n  return executeOperation(this.s.topology, removeUserOperation, callback);\r\n};\r\n\r\n/**\r\n * Set the current profiling level of MongoDB\r\n *\r\n * @param {string} level The new profiling level (off, slow_only, all).\r\n * @param {Object} [options] Optional settings\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~resultCallback} [callback] The command result callback.\r\n * @return {Promise} returns Promise if no callback passed\r\n */\r\nDb.prototype.setProfilingLevel = function(level, options, callback) {\r\n  if (typeof options === 'function') (callback = options), (options = {});\r\n  options = options || {};\r\n\r\n  const setProfilingLevelOperation = new SetProfilingLevelOperation(this, level, options);\r\n\r\n  return executeOperation(this.s.topology, setProfilingLevelOperation, callback);\r\n};\r\n\r\n/**\r\n * Retrieve the current profiling information for MongoDB\r\n *\r\n * @param {Object} [options] Optional settings\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~resultCallback} [callback] The command result callback.\r\n * @return {Promise} returns Promise if no callback passed\r\n * @deprecated Query the system.profile collection directly.\r\n */\r\nDb.prototype.profilingInfo = deprecate(function(options, callback) {\r\n  if (typeof options === 'function') (callback = options), (options = {});\r\n  options = options || {};\r\n\r\n  return executeLegacyOperation(this.s.topology, profilingInfo, [this, options, callback]);\r\n}, 'Db.profilingInfo is deprecated. Query the system.profile collection directly.');\r\n\r\n/**\r\n * Retrieve the current profiling Level for MongoDB\r\n *\r\n * @param {Object} [options] Optional settings\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~resultCallback} [callback] The command result callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\r\nDb.prototype.profilingLevel = function(options, callback) {\r\n  if (typeof options === 'function') (callback = options), (options = {});\r\n  options = options || {};\r\n\r\n  const profilingLevelOperation = new ProfilingLevelOperation(this, options);\r\n\r\n  return executeOperation(this.s.topology, profilingLevelOperation, callback);\r\n};\r\n\r\n/**\r\n * Retrieves this collections index info.\r\n * @method\r\n * @param {string} name The name of the collection.\r\n * @param {object} [options] Optional settings.\r\n * @param {boolean} [options.full=false] Returns the full raw index information.\r\n * @param {(ReadPreference|string)} [options.readPreference] The preferred read preference (ReadPreference.PRIMARY, ReadPreference.PRIMARY_PREFERRED, ReadPreference.SECONDARY, ReadPreference.SECONDARY_PREFERRED, ReadPreference.NEAREST).\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @param {Db~resultCallback} [callback] The command result callback\r\n * @return {Promise} returns Promise if no callback passed\r\n */\r\nDb.prototype.indexInformation = function(name, options, callback) {\r\n  if (typeof options === 'function') (callback = options), (options = {});\r\n  options = options || {};\r\n\r\n  const indexInformationOperation = new IndexInformationOperation(this, name, options);\r\n\r\n  return executeOperation(this.s.topology, indexInformationOperation, callback);\r\n};\r\n\r\n/**\r\n * Unref all sockets\r\n * @method\r\n */\r\nDb.prototype.unref = function() {\r\n  this.s.topology.unref();\r\n};\r\n\r\n/**\r\n * Create a new Change Stream, watching for new changes (insertions, updates, replacements, deletions, and invalidations) in this database. Will ignore all changes to system collections.\r\n * @method\r\n * @since 3.1.0\r\n * @param {Array} [pipeline] An array of {@link https://docs.mongodb.com/manual/reference/operator/aggregation-pipeline/|aggregation pipeline stages} through which to pass change stream documents. This allows for filtering (using $match) and manipulating the change stream documents.\r\n * @param {object} [options] Optional settings\r\n * @param {string} [options.fullDocument='default'] Allowed values: ‘default’, ‘updateLookup’. When set to ‘updateLookup’, the change stream will include both a delta describing the changes to the document, as well as a copy of the entire document that was changed from some time after the change occurred.\r\n * @param {object} [options.resumeAfter] Specifies the logical starting point for the new change stream. This should be the _id field from a previously returned change stream document.\r\n * @param {number} [options.maxAwaitTimeMS] The maximum amount of time for the server to wait on new documents to satisfy a change stream query\r\n * @param {number} [options.batchSize=1000] The number of documents to return per batch. See {@link https://docs.mongodb.com/manual/reference/command/aggregate|aggregation documentation}.\r\n * @param {object} [options.collation] Specify collation settings for operation. See {@link https://docs.mongodb.com/manual/reference/command/aggregate|aggregation documentation}.\r\n * @param {ReadPreference} [options.readPreference] The read preference. Defaults to the read preference of the database. See {@link https://docs.mongodb.com/manual/reference/read-preference|read preference documentation}.\r\n * @param {Timestamp} [options.startAtOperationTime] receive change events that occur after the specified timestamp\r\n * @param {ClientSession} [options.session] optional session to use for this operation\r\n * @return {ChangeStream} a ChangeStream instance.\r\n */\r\nDb.prototype.watch = function(pipeline, options) {\r\n  pipeline = pipeline || [];\r\n  options = options || {};\r\n\r\n  // Allow optionally not specifying a pipeline\r\n  if (!Array.isArray(pipeline)) {\r\n    options = pipeline;\r\n    pipeline = [];\r\n  }\r\n\r\n  return new ChangeStream(this, pipeline, options);\r\n};\r\n\r\n/**\r\n * Return the db logger\r\n * @method\r\n * @return {Logger} return the db logger\r\n * @ignore\r\n */\r\nDb.prototype.getLogger = function() {\r\n  return this.s.logger;\r\n};\r\n\r\n/**\r\n * Db close event\r\n *\r\n * Emitted after a socket closed against a single server or mongos proxy.\r\n *\r\n * @event Db#close\r\n * @type {MongoError}\r\n */\r\n\r\n/**\r\n * Db reconnect event\r\n *\r\n *  * Server: Emitted when the driver has reconnected and re-authenticated.\r\n *  * ReplicaSet: N/A\r\n *  * Mongos: Emitted when the driver reconnects and re-authenticates successfully against a Mongos.\r\n *\r\n * @event Db#reconnect\r\n * @type {object}\r\n */\r\n\r\n/**\r\n * Db error event\r\n *\r\n * Emitted after an error occurred against a single server or mongos proxy.\r\n *\r\n * @event Db#error\r\n * @type {MongoError}\r\n */\r\n\r\n/**\r\n * Db timeout event\r\n *\r\n * Emitted after a socket timeout occurred against a single server or mongos proxy.\r\n *\r\n * @event Db#timeout\r\n * @type {MongoError}\r\n */\r\n\r\n/**\r\n * Db parseError event\r\n *\r\n * The parseError event is emitted if the driver detects illegal or corrupt BSON being received from the server.\r\n *\r\n * @event Db#parseError\r\n * @type {MongoError}\r\n */\r\n\r\n/**\r\n * Db fullsetup event, emitted when all servers in the topology have been connected to at start up time.\r\n *\r\n * * Server: Emitted when the driver has connected to the single server and has authenticated.\r\n * * ReplSet: Emitted after the driver has attempted to connect to all replicaset members.\r\n * * Mongos: Emitted after the driver has attempted to connect to all mongos proxies.\r\n *\r\n * @event Db#fullsetup\r\n * @type {Db}\r\n */\r\n\r\n// Constants\r\nDb.SYSTEM_NAMESPACE_COLLECTION = CONSTANTS.SYSTEM_NAMESPACE_COLLECTION;\r\nDb.SYSTEM_INDEX_COLLECTION = CONSTANTS.SYSTEM_INDEX_COLLECTION;\r\nDb.SYSTEM_PROFILE_COLLECTION = CONSTANTS.SYSTEM_PROFILE_COLLECTION;\r\nDb.SYSTEM_USER_COLLECTION = CONSTANTS.SYSTEM_USER_COLLECTION;\r\nDb.SYSTEM_COMMAND_COLLECTION = CONSTANTS.SYSTEM_COMMAND_COLLECTION;\r\nDb.SYSTEM_JS_COLLECTION = CONSTANTS.SYSTEM_JS_COLLECTION;\r\n\r\nmodule.exports = Db;\r\n"]},"metadata":{},"sourceType":"script"}