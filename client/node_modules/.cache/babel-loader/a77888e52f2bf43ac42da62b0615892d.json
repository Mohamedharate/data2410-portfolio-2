{"ast":null,"code":"import _toConsumableArray from\"/home/group16/data2410-portfolio-2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"/home/group16/data2410-portfolio-2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/group16/data2410-portfolio-2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"/home/group16/data2410-portfolio-2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/home/group16/data2410-portfolio-2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _inherits from\"/home/group16/data2410-portfolio-2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"/home/group16/data2410-portfolio-2/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import axios from\"axios\";import{BrowserRouter as Router,Route,Switch}from'react-router-dom';import Navbar from\"./Navbar\";import SignIn from\"../Authentication/SignIn\";import SignUp from\"../Authentication/SignUp\";import Mainpage from\"../Products/mainpage\";import Footer from\"./Footer\";import Productpage from\"../Products/productpage\";import addReview from\"../Products/addReview\";import ShoppingCart from\"../ShoppingCart/ShoppingCart\";import Checkout from\"../ShoppingCart/Checkout\";import ProfileMain from\"../UserProfile/ProfileMain\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Home=/*#__PURE__*/function(_Component){_inherits(Home,_Component);var _super=_createSuper(Home);function Home(props){var _this;_classCallCheck(this,Home);_this=_super.call(this,props);_this.state={toggleLogin:false,toggleRegister:false,toggleShoppingCart:false,toggleCheckOut:false,toggleProfilePage:false,isAuthenticated:false,navbar_loading:false,current_user:{},empty_cart:true,empty_cart_message:'Nothing to show here.',cart_objects:[],cart_counter:0,cart_total_price:0,cart_error_feedback:false,cart_success_feedback:false,cart_feedback_text:String};_this.componentDidMount=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return _this.Authenticated();case 2:case\"end\":return _context.stop();}}},_callee);}));_this.handleToggleLoginCallback=function(){_this.setState({toggleLogin:!_this.state.toggleLogin,toggleRegister:false,toggleShoppingCart:false,toggleCheckOut:false,toggleProfilePage:false});};_this.handleToggleRegisterCallback=function(){_this.setState({toggleLogin:false,toggleRegister:!_this.state.toggleRegister,toggleShoppingCart:false,toggleCheckOut:false,toggleProfilePage:false});};_this.handleToggleShoppingCartCallback=function(){_this.setState({toggleLogin:false,toggleRegister:false,toggleShoppingCart:!_this.state.toggleShoppingCart,toggleCheckOut:false,toggleProfilePage:false});};_this.handleToggleCheckOutCallback=function(){_this.setState({toggleLogin:false,toggleRegister:false,toggleShoppingCart:false,toggleCheckOut:!_this.state.toggleCheckOut,toggleProfilePage:false});};_this.handleToggleProfilePageCallback=function(){_this.setState({toggleLogin:false,toggleRegister:false,toggleShoppingCart:false,toggleCheckOut:false,toggleProfilePage:!_this.state.toggleProfilePage});};_this.handleQuantityIncreaseCallback=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(item_id){var cart_objects,index;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:cart_objects=_toConsumableArray(_this.state.cart_objects);index=cart_objects.findIndex(function(i){return i.itemId===item_id;});cart_objects[index].quantity++;_context2.next=5;return axios({method:'post',url:'https://localhost:3001/api/cart/addToCart',data:{product_id:cart_objects[index].itemId,quantity:1}}).then(function(r){_this.updateCartCounterAndPrice(cart_objects);_this.setState({cart_objects:cart_objects});});case 5:case\"end\":return _context2.stop();}}},_callee2);}));return function(_x){return _ref2.apply(this,arguments);};}();_this.handleQuantityDecreaseCallback=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(item_id){var cart_objects,index;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:cart_objects=_toConsumableArray(_this.state.cart_objects);index=cart_objects.findIndex(function(i){return i.itemId===item_id;});if(!(cart_objects[index].quantity>0)){_context3.next=6;break;}cart_objects[index].quantity--;_context3.next=6;return axios({method:'put',url:'https://localhost:3001/api/cart/deleteFromCart',data:{product_id:cart_objects[index].itemId,quantity:1}}).then(function(r){_this.updateCartCounterAndPrice(cart_objects);_this.setState({cart_objects:cart_objects});});case 6:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x2){return _ref3.apply(this,arguments);};}();_this.handleAddToCartCallback=function(product,quantity){var Product=product;Product.quantity=quantity;Product.price=Object.values(product.price);var cart_objects=[].concat(_toConsumableArray(_this.state.cart_objects),[Product]);_this.updateCartCounterAndPrice(cart_objects);_this.setState({cart_objects:cart_objects,empty_cart:false});};_this.handleOrderCompleteCallback=function(user){_this.getCartObjects(user);var cart_objects=_toConsumableArray(user.cart);_this.updateCartCounterAndPrice(cart_objects);_this.setState({cart_objects:cart_objects,empty_cart:true});};_this.handleLoginCallback=function(user){var current_user=user;_this.setState({current_user:current_user,isAuthenticated:true});_this.getCartObjects(current_user);_this.setState({toggleLogin:false});};_this.handleLogoutCallback=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(){return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:_context4.next=2;return axios({method:'post',url:'https://localhost:3001/logout',data:{}}).then(function(){var cart_objects=[];_this.updateCartCounterAndPrice(cart_objects);_this.setState({current_user:{},isAuthenticated:false,toggleShoppingCart:false,toggleProfilePage:false});});case 2:case\"end\":return _context4.stop();}}},_callee4);}));_this.Authenticated=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_this.setState({navbar_loading:true});_context5.next=3;return axios.get('https://localhost:3001/api/users/isAuthenticated').then(function(response){if(response.status===200){// Session is auth\nvar current_user=response.data;_this.getCartObjects(current_user);_this.setState({current_user:current_user,isAuthenticated:true,navbar_loading:false});}else if(response.status===206){// Session is not auth but has items in cart\n_this.state.empty_cart=false;var cart_objects=_toConsumableArray(response.data.Cart);_this.updateCartCounterAndPrice(cart_objects);_this.setState({cart_objects:cart_objects,current_user:{},isAuthenticated:false,navbar_loading:false});}else{// Session is not auth and has no items in cart\n_this.setState({current_user:{},isAuthenticated:false,navbar_loading:false});}}).catch(function(error){console.log(error);_this.setState({current_user:{},isAuthenticated:false,navbar_loading:false});});case 3:case\"end\":return _context5.stop();}}},_callee5);}));_this.getCartObjects=function(user){if(user.cart.length===0){_this.state.empty_cart=true;_this.state.empty_cart_message='There is nothing to see here!';return true;}else{_this.state.empty_cart=false;var cart_objects=_toConsumableArray(user.cart);_this.updateCartCounterAndPrice(cart_objects);_this.setState({cart_objects:cart_objects});return false;}};_this.updateCartCounterAndPrice=function(cartArray){var cart_counter=0;var cart_total_price=0;cartArray.forEach(function(product){cart_counter+=parseInt(product.quantity);cart_total_price+=parseInt(product.price)*parseInt(product.quantity);});_this.setState({cart_counter:cart_counter,cart_total_price:cart_total_price});};return _this;}_createClass(Home,[{key:\"render\",value:function render(){var _this2=this;return/*#__PURE__*/_jsx(Router,{children:/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(Navbar,{toggleLoginCallback:this.handleToggleLoginCallback,toggleRegisterCallback:this.handleToggleRegisterCallback,toggleShoppingCartCallback:this.handleToggleShoppingCartCallback,toggleProfilePageCallback:this.handleToggleProfilePageCallback,isAuthenticated:this.state.isAuthenticated,loading:this.state.navbar_loading,current_user:this.state.current_user,cart_counter:this.state.cart_counter,cart_total_price:this.state.cart_total_price}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Route,{exact:true,path:\"/\",component:Mainpage}),/*#__PURE__*/_jsx(Route,{exact:true,path:\"/products/:itemId\",component:function component(){return/*#__PURE__*/_jsx(Productpage,{itemId:window.location.href.split('/').pop(),handleAddToCartCallback:_this2.handleAddToCartCallback});}}),/*#__PURE__*/_jsx(Route,{path:\"/addReview/:itemId\",component:addReview})]}),this.state.toggleLogin&&/*#__PURE__*/_jsx(SignIn,{loginCallback:this.handleLoginCallback,close:this.handleToggleLoginCallback}),this.state.toggleRegister&&/*#__PURE__*/_jsx(SignUp,{close:this.handleToggleRegisterCallback}),this.state.toggleProfilePage&&/*#__PURE__*/_jsx(ProfileMain,{close:this.handleToggleProfilePageCallback,handleLogout:this.handleLogoutCallback,current_user:this.state.current_user}),this.state.toggleCheckOut&&/*#__PURE__*/_jsx(Checkout,{cart_objects:this.state.cart_objects,current_user:this.state.current_user,price_total:this.state.cart_total_price,signed_in:this.state.isAuthenticated,order_complete:this.handleOrderCompleteCallback,close:this.handleToggleCheckOutCallback}),this.state.toggleShoppingCart&&/*#__PURE__*/_jsx(ShoppingCart,{handleAddToCartCallback:this.handleAddToCartCallback,quantity_increase:this.handleQuantityIncreaseCallback,quantity_decrease:this.handleQuantityDecreaseCallback,onCheckOut:this.handleToggleCheckOutCallback,close:this.handleToggleShoppingCartCallback,empty_cart:this.state.empty_cart,empty_cart_message:this.state.empty_cart_message,cart_objects:this.state.cart_objects,cart_total_price:this.state.cart_total_price,toggle_error_feedback:this.state.cart_error_feedback,toggle_success_feedback:this.state.cart_success_feedback,feedback_text:this.state.cart_feedback_text}),/*#__PURE__*/_jsx(Footer,{toggle_admin:this.props.toggle_admin})]})});}}]);return Home;}(Component);// <About/>\nexport default Home;","map":{"version":3,"sources":["/home/group16/data2410-portfolio-2/client/src/Components/Webstore/Home.jsx"],"names":["React","Component","axios","BrowserRouter","Router","Route","Switch","Navbar","SignIn","SignUp","Mainpage","Footer","Productpage","addReview","ShoppingCart","Checkout","ProfileMain","Home","props","state","toggleLogin","toggleRegister","toggleShoppingCart","toggleCheckOut","toggleProfilePage","isAuthenticated","navbar_loading","current_user","empty_cart","empty_cart_message","cart_objects","cart_counter","cart_total_price","cart_error_feedback","cart_success_feedback","cart_feedback_text","String","componentDidMount","Authenticated","handleToggleLoginCallback","setState","handleToggleRegisterCallback","handleToggleShoppingCartCallback","handleToggleCheckOutCallback","handleToggleProfilePageCallback","handleQuantityIncreaseCallback","item_id","index","findIndex","i","itemId","quantity","method","url","data","product_id","then","r","updateCartCounterAndPrice","handleQuantityDecreaseCallback","handleAddToCartCallback","product","Product","price","Object","values","handleOrderCompleteCallback","user","getCartObjects","cart","handleLoginCallback","handleLogoutCallback","get","response","status","Cart","catch","error","console","log","length","cartArray","forEach","parseInt","window","location","href","split","pop","toggle_admin"],"mappings":"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","sourcesContent":["import React, {Component,} from \"react\";\nimport axios from \"axios\";\nimport {BrowserRouter as Router, Route, Switch} from 'react-router-dom';\nimport Navbar from \"./Navbar\";\nimport SignIn from \"../Authentication/SignIn\";\nimport SignUp from \"../Authentication/SignUp\";\nimport Mainpage from \"../Products/mainpage\";\nimport Footer from \"./Footer\";\nimport Productpage from \"../Products/productpage\";\nimport addReview from \"../Products/addReview\";\nimport ShoppingCart from \"../ShoppingCart/ShoppingCart\";\nimport Checkout from \"../ShoppingCart/Checkout\";\nimport ProfileMain from \"../UserProfile/ProfileMain\"\n\n\nclass Home extends Component {\n    constructor(props) {\n        super(props);\n    }\n\n    state = {\n        toggleLogin: false,\n        toggleRegister: false,\n        toggleShoppingCart: false,\n        toggleCheckOut: false,\n        toggleProfilePage: false,\n        isAuthenticated: false,\n        navbar_loading: false,\n        current_user: {},\n        empty_cart: true,\n        empty_cart_message: 'Nothing to show here.',\n        cart_objects: [],\n        cart_counter: 0,\n        cart_total_price: 0,\n        cart_error_feedback: false,\n        cart_success_feedback: false,\n        cart_feedback_text: String,\n    };\n\n    componentDidMount = async () => {\n        await this.Authenticated()\n    };\n\n    // Handlers\n    // Toggle windows.\n    handleToggleLoginCallback = () => {\n        this.setState({\n            toggleLogin: !this.state.toggleLogin,\n            toggleRegister: false,\n            toggleShoppingCart: false,\n            toggleCheckOut: false,\n            toggleProfilePage: false,\n        });\n    }\n    handleToggleRegisterCallback = () => {\n        this.setState({\n            toggleLogin: false,\n            toggleRegister: !this.state.toggleRegister,\n            toggleShoppingCart: false,\n            toggleCheckOut: false,\n            toggleProfilePage: false,\n        });\n    }\n    handleToggleShoppingCartCallback = () => {\n        this.setState({\n            toggleLogin: false,\n            toggleRegister: false,\n            toggleShoppingCart: !this.state.toggleShoppingCart,\n            toggleCheckOut: false,\n            toggleProfilePage: false,\n        });\n    }\n    handleToggleCheckOutCallback = () => {\n        this.setState({\n            toggleLogin: false,\n            toggleRegister: false,\n            toggleShoppingCart: false,\n            toggleCheckOut: !this.state.toggleCheckOut,\n            toggleProfilePage: false,\n        })\n    }\n    handleToggleProfilePageCallback = () => {\n        this.setState({\n            toggleLogin: false,\n            toggleRegister: false,\n            toggleShoppingCart: false,\n            toggleCheckOut: false,\n            toggleProfilePage: !this.state.toggleProfilePage,\n        })\n    }\n\n    // Handle cart\n    handleQuantityIncreaseCallback = async item_id => {\n        const cart_objects = [...this.state.cart_objects];\n        const index = cart_objects.findIndex(i => i.itemId === item_id)\n        cart_objects[index].quantity++;\n        await axios({\n            method: 'post',\n            url: 'https://localhost:3001/api/cart/addToCart',\n            data: {\n                product_id: cart_objects[index].itemId,\n                quantity: 1\n            },\n        }).then(r => {\n            this.updateCartCounterAndPrice(cart_objects);\n            this.setState({cart_objects})\n        })\n    }\n    handleQuantityDecreaseCallback = async item_id => {\n        const cart_objects = [...this.state.cart_objects];\n        const index = cart_objects.findIndex(i => i.itemId === item_id)\n        if (cart_objects[index].quantity > 0) {\n            cart_objects[index].quantity--;\n            await axios({\n                method: 'put',\n                url: 'https://localhost:3001/api/cart/deleteFromCart',\n                data: {\n                    product_id: cart_objects[index].itemId,\n                    quantity: 1\n                },\n            }).then(r => {\n                this.updateCartCounterAndPrice(cart_objects);\n                this.setState({cart_objects});\n            })\n        }\n    }\n    handleAddToCartCallback = (product, quantity) => {\n        const Product = product;\n        Product.quantity = quantity;\n        Product.price = Object.values(product.price);\n\n        const cart_objects = [...this.state.cart_objects, Product];\n        this.updateCartCounterAndPrice(cart_objects);\n        this.setState({\n            cart_objects,\n            empty_cart: false\n        })\n    }\n    handleOrderCompleteCallback = user => {\n        this.getCartObjects(user)\n        const cart_objects = [...user.cart]\n        this.updateCartCounterAndPrice(cart_objects)\n        this.setState({cart_objects, empty_cart: true})\n    }\n\n\n    // Handle authentication.\n    handleLoginCallback = user => {\n        const current_user = user;\n        this.setState({current_user, isAuthenticated: true});\n        this.getCartObjects(current_user);\n        this.setState({toggleLogin: false});\n    };\n    handleLogoutCallback = async () => {\n        await axios({\n            method: 'post',\n            url: 'https://localhost:3001/logout',\n            data: {}\n        }).then(() => {\n            const cart_objects = [];\n            this.updateCartCounterAndPrice(cart_objects);\n            this.setState({\n                current_user: {},\n                isAuthenticated: false,\n                toggleShoppingCart: false,\n                toggleProfilePage: false,\n            });\n        })\n    };\n    Authenticated = async () => {\n        this.setState({navbar_loading: true})\n        await axios.get('https://localhost:3001/api/users/isAuthenticated')\n            .then(response => {\n                if (response.status === 200) {\n                    // Session is auth\n                    const current_user = response.data;\n                    this.getCartObjects(current_user);\n                    this.setState({\n                        current_user,\n                        isAuthenticated: true,\n                        navbar_loading: false,\n                    });\n                } else if (response.status === 206) {\n                    // Session is not auth but has items in cart\n                    this.state.empty_cart = false;\n                    const cart_objects = [...response.data.Cart];\n                    this.updateCartCounterAndPrice(cart_objects);\n                    this.setState({\n                        cart_objects,\n                        current_user: {},\n                        isAuthenticated: false,\n                        navbar_loading: false,\n                    });\n                } else {\n                    // Session is not auth and has no items in cart\n                    this.setState({\n                        current_user: {},\n                        isAuthenticated: false,\n                        navbar_loading: false,\n                    });\n                }\n\n            }).catch(error => {\n                console.log(error);\n                this.setState({\n                    current_user: {},\n                    isAuthenticated: false,\n                    navbar_loading: false,\n                });\n            });\n    };\n\n    // Cart\n    // Instantiate Cart\n    getCartObjects = user => {\n        if (user.cart.length === 0) {\n            this.state.empty_cart = true;\n            this.state.empty_cart_message = 'There is nothing to see here!';\n            return true;\n        } else {\n            this.state.empty_cart = false;\n            const cart_objects = [...user.cart];\n            this.updateCartCounterAndPrice(cart_objects);\n            this.setState({cart_objects});\n            return false;\n        }\n    };\n    // Updating cart values for the navbar.\n    updateCartCounterAndPrice = cartArray => {\n        let cart_counter = 0;\n        let cart_total_price = 0;\n        cartArray.forEach(product => {\n            cart_counter += parseInt(product.quantity);\n            cart_total_price += parseInt(product.price) * parseInt(product.quantity)\n\n        });\n        this.setState({cart_counter, cart_total_price})\n    }\n\n    render() {\n        return (\n            <Router>\n                <React.Fragment>\n                    <Navbar\n                        toggleLoginCallback={this.handleToggleLoginCallback}\n                        toggleRegisterCallback={this.handleToggleRegisterCallback}\n                        toggleShoppingCartCallback={this.handleToggleShoppingCartCallback}\n                        toggleProfilePageCallback={this.handleToggleProfilePageCallback}\n                        isAuthenticated={this.state.isAuthenticated}\n                        loading={this.state.navbar_loading}\n                        current_user={this.state.current_user}\n                        cart_counter={this.state.cart_counter}\n                        cart_total_price={this.state.cart_total_price}\n                    />\n                    <Switch>\n                        <Route exact path=\"/\" component={Mainpage}/>\n                        <Route exact path=\"/products/:itemId\" component={() =>\n                            <Productpage itemId={window.location.href.split('/').pop()}\n                                         handleAddToCartCallback={this.handleAddToCartCallback}/>}/>\n                        <Route path=\"/addReview/:itemId\" component={addReview}/>\n                    </Switch>\n                    {this.state.toggleLogin && <SignIn\n                        loginCallback={this.handleLoginCallback}\n                        close={this.handleToggleLoginCallback}\n                    />}\n                    {this.state.toggleRegister && <SignUp\n                        close={this.handleToggleRegisterCallback}\n                    />}\n                    {this.state.toggleProfilePage && <ProfileMain\n                        close={this.handleToggleProfilePageCallback}\n                        handleLogout={this.handleLogoutCallback}\n                        current_user={this.state.current_user}\n                    />}\n                    {this.state.toggleCheckOut && <Checkout\n                        cart_objects={this.state.cart_objects}\n                        current_user={this.state.current_user}\n                        price_total={this.state.cart_total_price}\n                        signed_in={this.state.isAuthenticated}\n                        order_complete={this.handleOrderCompleteCallback}\n                        close={this.handleToggleCheckOutCallback}\n                    />}\n                    {this.state.toggleShoppingCart &&\n                    <ShoppingCart\n                        handleAddToCartCallback={this.handleAddToCartCallback}\n                        quantity_increase={this.handleQuantityIncreaseCallback}\n                        quantity_decrease={this.handleQuantityDecreaseCallback}\n                        onCheckOut={this.handleToggleCheckOutCallback}\n                        close={this.handleToggleShoppingCartCallback}\n                        empty_cart={this.state.empty_cart}\n                        empty_cart_message={this.state.empty_cart_message}\n                        cart_objects={this.state.cart_objects}\n                        cart_total_price={this.state.cart_total_price}\n                        toggle_error_feedback={this.state.cart_error_feedback}\n                        toggle_success_feedback={this.state.cart_success_feedback}\n                        feedback_text={this.state.cart_feedback_text}\n                    />\n                    }\n                    <Footer toggle_admin={this.props.toggle_admin}/>\n                </React.Fragment>\n            </Router>\n        );\n    }\n}\n\n// <About/>\n\nexport default Home;"]},"metadata":{},"sourceType":"module"}