{"ast":null,"code":"import _toConsumableArray from\"C:/OsloMet/2020-2021/Datanettverk/portfolio2-group7/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _regeneratorRuntime from\"C:/OsloMet/2020-2021/Datanettverk/portfolio2-group7/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/OsloMet/2020-2021/Datanettverk/portfolio2-group7/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _classCallCheck from\"C:/OsloMet/2020-2021/Datanettverk/portfolio2-group7/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"C:/OsloMet/2020-2021/Datanettverk/portfolio2-group7/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _assertThisInitialized from\"C:/OsloMet/2020-2021/Datanettverk/portfolio2-group7/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized\";import _inherits from\"C:/OsloMet/2020-2021/Datanettverk/portfolio2-group7/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import _createSuper from\"C:/OsloMet/2020-2021/Datanettverk/portfolio2-group7/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper\";import React,{Component}from\"react\";import axios from\"axios\";import{BrowserRouter as Router,Route,Switch}from'react-router-dom';import Navbar from\"./navbar\";import Login from\"./login\";import Register from\"./register\";import About from\"./about\";import Mainpage from\"./Products/mainpage\";import Footer from\"./footer\";import Productpage from\"./Products/productpage\";import addReview from\"./Products/addReview\";import ShoppingCart from\"./shoppingCart\";import Orders from\"./orders\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Home=/*#__PURE__*/function(_Component){_inherits(Home,_Component);var _super=_createSuper(Home);function Home(props){var _this;_classCallCheck(this,Home);_this=_super.call(this,props);_this.state={toggleLogin:false,toggleRegister:false,toggleShoppingCart:false,isAuthenticated:false,current_user:{},empty_cart:false,empty_cart_message:'Nothing to show here.',cart_objects:[],cart_counter:0,cart_total_price:0,cart_error_feedback:false,cart_success_feedback:false,cart_feedback_text:String};_this.componentDidMount=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:window.addEventListener('load',_this.handleLoad);case 1:case\"end\":return _context.stop();}}},_callee);}));_this.handleLoad=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_this.tryIsAuthenticated().then();case 1:case\"end\":return _context2.stop();}}},_callee2);}));_this.handleToggleLoginCallback=function(){_this.setState({toggleLogin:!_this.state.toggleLogin,toggleRegister:false});};_this.handleToggleRegisterCallback=function(){_this.setState({toggleLogin:false,toggleRegister:!_this.state.toggleRegister});};_this.handleToggleShoppingCartCallback=function(){_this.setState({toggleShoppingCart:!_this.state.toggleShoppingCart});};_this.handleQuantityIncreaseCallback=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(item_id){var cart_objects,index;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:cart_objects=_toConsumableArray(_this.state.cart_objects);index=cart_objects.findIndex(function(i){return i.itemId===item_id;});cart_objects[index].quantity++;_context3.next=5;return axios({method:'post',url:'http://localhost:3001/api/cart/addToCart',data:{product_id:cart_objects[index].itemId,quantity:cart_objects[index].quantity}}).then(function(r){_this.updateCartCounterAndPrice(cart_objects);_this.setState({cart_objects:cart_objects});});case 5:case\"end\":return _context3.stop();}}},_callee3);}));return function(_x){return _ref3.apply(this,arguments);};}();_this.handleQuantityDecreaseCallback=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee4(item_id){var cart_objects,index;return _regeneratorRuntime.wrap(function _callee4$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:cart_objects=_toConsumableArray(_this.state.cart_objects);index=cart_objects.findIndex(function(i){return i.itemId===item_id;});cart_objects[index].quantity--;_context4.next=5;return axios({method:'put',url:'http://localhost:3001/api/cart/deleteFromCart',data:{product_id:cart_objects[index].itemId,quantity:cart_objects[index].quantity}}).then(function(r){_this.updateCartCounterAndPrice(cart_objects);_this.setState({cart_objects:cart_objects});});case 5:case\"end\":return _context4.stop();}}},_callee4);}));return function(_x2){return _ref4.apply(this,arguments);};}();_this.handleAddToCartCallback=function(product,quantity){var Product=product;Product.quantity=quantity;var cart_objects=[].concat(_toConsumableArray(_this.state.cart_objects),[Product]);_this.updateCartCounterAndPrice(cart_objects);_this.setState({cart_objects:cart_objects});};_this.handleCheckOutCallback=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee5(){return _regeneratorRuntime.wrap(function _callee5$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:console.log(\"checkout\");_this.placeNewOrder();//TODO Her må det lages et Checkout vindu som tar inn informasjon om levering.\ncase 2:case\"end\":return _context5.stop();}}},_callee5);}));_this.handleLoginCallback=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee6(){return _regeneratorRuntime.wrap(function _callee6$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:_this.tryIsAuthenticated();case 1:case\"end\":return _context6.stop();}}},_callee6);}));_this.handleLogoutCallback=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee7(){return _regeneratorRuntime.wrap(function _callee7$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:_this.tryLogout();_this.tryIsAuthenticated();_this.getCartObjects();_this.state.toggleShoppingCart=false;case 4:case\"end\":return _context7.stop();}}},_callee7);}));_this.tryIsAuthenticated=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee8(){return _regeneratorRuntime.wrap(function _callee8$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:_context8.next=2;return axios.get('http://localhost:3001/api/users/isAuthenticated').then(function(response){_this.setState({isAuthenticated:true});_this.setState({current_user:response.data});_this.setState({toggleLogin:false});_this.getCartObjects();}).catch(function(error){_this.setState({isAuthenticated:false});_this.setState({current_user:{}});});case 2:case\"end\":return _context8.stop();}}},_callee8);}));_this.tryLogout=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee9(){return _regeneratorRuntime.wrap(function _callee9$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:_context9.next=2;return axios({method:'post',url:'http://localhost:3001/logout',data:{}});case 2:case\"end\":return _context9.stop();}}},_callee9);}));_this.getCartObjects=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee10(){return _regeneratorRuntime.wrap(function _callee10$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:_context10.next=2;return axios.get('http://localhost:3001/api/cart/getCart').then(function(response){if(response.data.message){_this.state.empty_cart=true;_this.state.empty_cart_message=response.data.message;return true;}else{_this.state.empty_cart=false;var cart_objects=_toConsumableArray(response.data.products);_this.updateCartCounterAndPrice(cart_objects);_this.setState({cart_objects:cart_objects});return false;}}).catch(function(error){console.log(error.data);});case 2:case\"end\":return _context10.stop();}}},_callee10);}));_this.updateCartCounterAndPrice=function(cartArray){var cart_counter=0;var cart_total_price=0;cartArray.forEach(function(product){cart_counter+=parseInt(product.quantity);cart_total_price+=parseInt(product.price)*parseInt(product.quantity);});_this.setState({cart_counter:cart_counter,cart_total_price:cart_total_price});};_this.placeNewOrder=/*#__PURE__*/_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee11(){return _regeneratorRuntime.wrap(function _callee11$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:_context11.next=2;return axios({method:'post',url:'http://localhost:3001/api/orders/newOrder',data:{}//TODO add correct data\n}).then(function(r){_this.setState({cart_error_feedback:false,cart_success_feedback:true,cart_feedback_text:r.data.Message}).catch(function(err){_this.setState({cart_error_feedback:true,cart_success_feedback:false,cart_feedback_text:String});});});case 2:case\"end\":return _context11.stop();}}},_callee11);}));_this.handleLoad=_this.handleLoad.bind(_assertThisInitialized(_this));return _this;}_createClass(Home,[{key:\"render\",value:function render(){return/*#__PURE__*/_jsx(Router,{children:/*#__PURE__*/_jsxs(React.Fragment,{children:[/*#__PURE__*/_jsx(Navbar,{toggleLoginCallback:this.handleToggleLoginCallback,toggleRegisterCallback:this.handleToggleRegisterCallback,toggleShoppingCartCallback:this.handleToggleShoppingCartCallback,handleLogoutCallback:this.handleLogoutCallback,isAuthenticated:this.state.isAuthenticated,current_user:this.state.current_user,cart_counter:this.state.cart_counter,cart_total_price:this.state.cart_total_price}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(Route,{exact:true,path:\"/\",component:Mainpage}),/*#__PURE__*/_jsx(Route,{path:\"/products/:itemId\",component:Productpage}),/*#__PURE__*/_jsx(Route,{path:\"/addReview/:itemId\",component:addReview}),/*#__PURE__*/_jsx(Route,{path:\"/chart\",component:ShoppingCart}),/*#__PURE__*/_jsx(Route,{path:\"/orders\",component:Orders})]}),this.state.toggleLogin&&/*#__PURE__*/_jsx(Login,{loginCallback:this.handleLoginCallback}),this.state.toggleRegister&&/*#__PURE__*/_jsx(Register,{registerCallback:this.handleToggleLoginCallback}),this.state.toggleShoppingCart&&/*#__PURE__*/_jsx(ShoppingCart,{postToCart:this.handleAddToCartCallback,quantity_increase:this.handleQuantityIncreaseCallback,quantity_decrease:this.handleQuantityDecreaseCallback,onCheckOut:this.handleCheckOutCallback,empty_cart:this.state.empty_cart,empty_cart_message:this.state.empty_cart_message,cart_objects:this.state.cart_objects,cart_total_price:this.state.cart_total_price,toggle_error_feedback:this.state.cart_error_feedback,toggle_success_feedback:this.state.cart_success_feedback,feedback_text:this.state.cart_feedback_text}),/*#__PURE__*/_jsx(About,{}),/*#__PURE__*/_jsx(Footer,{toggle_admin:this.props.toggle_admin})]})});}}]);return Home;}(Component);export default Home;","map":{"version":3,"sources":["C:/OsloMet/2020-2021/Datanettverk/portfolio2-group7/client/src/Components/home.jsx"],"names":["React","Component","axios","BrowserRouter","Router","Route","Switch","Navbar","Login","Register","About","Mainpage","Footer","Productpage","addReview","ShoppingCart","Orders","Home","props","state","toggleLogin","toggleRegister","toggleShoppingCart","isAuthenticated","current_user","empty_cart","empty_cart_message","cart_objects","cart_counter","cart_total_price","cart_error_feedback","cart_success_feedback","cart_feedback_text","String","componentDidMount","window","addEventListener","handleLoad","tryIsAuthenticated","then","handleToggleLoginCallback","setState","handleToggleRegisterCallback","handleToggleShoppingCartCallback","handleQuantityIncreaseCallback","item_id","index","findIndex","i","itemId","quantity","method","url","data","product_id","r","updateCartCounterAndPrice","handleQuantityDecreaseCallback","handleAddToCartCallback","product","Product","handleCheckOutCallback","console","log","placeNewOrder","handleLoginCallback","handleLogoutCallback","tryLogout","getCartObjects","get","response","catch","error","message","products","cartArray","forEach","parseInt","price","Message","err","bind","toggle_admin"],"mappings":"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","sourcesContent":["import React, {Component} from \"react\";\r\nimport axios from \"axios\";\r\nimport {BrowserRouter as Router, Route, Switch} from 'react-router-dom';\r\nimport Navbar from \"./navbar\";\r\nimport Login from \"./login\";\r\nimport Register from \"./register\";\r\nimport About from \"./about\";\r\nimport Mainpage from \"./Products/mainpage\";\r\nimport Footer from \"./footer\";\r\nimport Productpage from \"./Products/productpage\";\r\nimport addReview from \"./Products/addReview\";\r\nimport ShoppingCart from \"./shoppingCart\";\r\nimport Orders from \"./orders\";\r\n\r\n\r\nclass Home extends Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.handleLoad = this.handleLoad.bind(this);\r\n    }\r\n\r\n    state = {\r\n        toggleLogin: false,\r\n        toggleRegister: false,\r\n        toggleShoppingCart: false,\r\n        isAuthenticated: false,\r\n        current_user: {},\r\n        empty_cart: false,\r\n        empty_cart_message: 'Nothing to show here.',\r\n        cart_objects: [],\r\n        cart_counter: 0,\r\n        cart_total_price: 0,\r\n        cart_error_feedback: false,\r\n        cart_success_feedback: false,\r\n        cart_feedback_text: String,\r\n    };\r\n\r\n    // Init/on load\r\n    componentDidMount = async () => {\r\n        window.addEventListener('load', this.handleLoad);\r\n    };\r\n    handleLoad = async () => {\r\n        this.tryIsAuthenticated().then()\r\n    };\r\n\r\n    // Handlers\r\n    // Toggle windows.\r\n    handleToggleLoginCallback = () => {\r\n        this.setState({toggleLogin: !this.state.toggleLogin, toggleRegister: false});\r\n    }\r\n    handleToggleRegisterCallback = () => {\r\n        this.setState({toggleLogin: false, toggleRegister: !this.state.toggleRegister});\r\n    }\r\n    handleToggleShoppingCartCallback = () => {\r\n        this.setState({toggleShoppingCart: !this.state.toggleShoppingCart});\r\n    }\r\n\r\n    // Handle cart\r\n    handleQuantityIncreaseCallback = async item_id => {\r\n        const cart_objects = [...this.state.cart_objects];\r\n        const index = cart_objects.findIndex(i => i.itemId === item_id)\r\n        cart_objects[index].quantity++;\r\n        await axios({\r\n            method: 'post',\r\n            url: 'http://localhost:3001/api/cart/addToCart',\r\n            data: {\r\n                product_id: cart_objects[index].itemId,\r\n                quantity: cart_objects[index].quantity\r\n            },\r\n        }).then(r => {\r\n            this.updateCartCounterAndPrice(cart_objects);\r\n            this.setState({cart_objects})\r\n        })\r\n    }\r\n    handleQuantityDecreaseCallback = async item_id => {\r\n        const cart_objects = [...this.state.cart_objects];\r\n        const index = cart_objects.findIndex(i => i.itemId === item_id)\r\n        cart_objects[index].quantity--;\r\n        await axios({\r\n            method: 'put',\r\n            url: 'http://localhost:3001/api/cart/deleteFromCart',\r\n            data: {\r\n                product_id: cart_objects[index].itemId,\r\n                quantity: cart_objects[index].quantity\r\n            },\r\n        }).then(r => {\r\n            this.updateCartCounterAndPrice(cart_objects);\r\n            this.setState({cart_objects});\r\n        })\r\n    }\r\n    handleAddToCartCallback = (product, quantity) => {\r\n        const Product = product;\r\n        Product.quantity = quantity;\r\n\r\n        const cart_objects = [...this.state.cart_objects, Product];\r\n        this.updateCartCounterAndPrice(cart_objects);\r\n        this.setState({cart_objects})\r\n    }\r\n\r\n    // Handle checkout\r\n    handleCheckOutCallback = async () => {\r\n        console.log(\"checkout\");\r\n        this.placeNewOrder()\r\n        //TODO Her må det lages et Checkout vindu som tar inn informasjon om levering.\r\n    }\r\n\r\n    // Handle authentication.\r\n    handleLoginCallback = async () => {\r\n        this.tryIsAuthenticated();\r\n    };\r\n    handleLogoutCallback = async () => {\r\n        this.tryLogout();\r\n        this.tryIsAuthenticated();\r\n        this.getCartObjects();\r\n        this.state.toggleShoppingCart = false;\r\n    };\r\n\r\n    // Api calls\r\n    tryIsAuthenticated = async () => {\r\n        await axios.get('http://localhost:3001/api/users/isAuthenticated')\r\n            .then(response => {\r\n                this.setState({isAuthenticated: true});\r\n                this.setState({current_user: response.data});\r\n                this.setState({toggleLogin: false});\r\n                this.getCartObjects();\r\n            }).catch(error => {\r\n                this.setState({isAuthenticated: false});\r\n                this.setState({current_user: {}});\r\n            });\r\n    };\r\n\r\n    tryLogout = async () => {\r\n        await axios({\r\n            method: 'post',\r\n            url: 'http://localhost:3001/logout',\r\n            data: {}\r\n        })\r\n    };\r\n\r\n    getCartObjects = async () => {\r\n        await axios.get('http://localhost:3001/api/cart/getCart')\r\n            .then(response => {\r\n                if (response.data.message) {\r\n                    this.state.empty_cart = true;\r\n                    this.state.empty_cart_message = response.data.message;\r\n                    return true;\r\n                } else {\r\n                    this.state.empty_cart = false;\r\n                    const cart_objects = [...response.data.products];\r\n                    this.updateCartCounterAndPrice(cart_objects);\r\n                    this.setState({cart_objects});\r\n                    return false;\r\n                }\r\n            }).catch(error => {\r\n                console.log(error.data)\r\n            })\r\n    };\r\n\r\n    // Updating cart values for the navbar.\r\n    updateCartCounterAndPrice = cartArray => {\r\n        let cart_counter = 0;\r\n        let cart_total_price = 0;\r\n        cartArray.forEach(product => {\r\n            cart_counter += parseInt(product.quantity);\r\n            cart_total_price += parseInt(product.price) * parseInt(product.quantity)\r\n        });\r\n        this.setState({cart_counter, cart_total_price})\r\n    }\r\n\r\n    placeNewOrder = async () => {\r\n        await axios({\r\n            method: 'post',\r\n            url: 'http://localhost:3001/api/orders/newOrder',\r\n            data: {}, //TODO add correct data\r\n        }).then(r => {\r\n            this.setState({\r\n                cart_error_feedback: false,\r\n                cart_success_feedback: true,\r\n                cart_feedback_text: r.data.Message\r\n            }).catch(err => {\r\n                this.setState({\r\n                    cart_error_feedback: true,\r\n                    cart_success_feedback: false,\r\n                    cart_feedback_text: String\r\n                })\r\n            });\r\n        })\r\n    }\r\n\r\n    render() {\r\n        return (\r\n            <Router>\r\n                <React.Fragment>\r\n                    <Navbar\r\n                        toggleLoginCallback={this.handleToggleLoginCallback}\r\n                        toggleRegisterCallback={this.handleToggleRegisterCallback}\r\n                        toggleShoppingCartCallback={this.handleToggleShoppingCartCallback}\r\n                        handleLogoutCallback={this.handleLogoutCallback}\r\n                        isAuthenticated={this.state.isAuthenticated}\r\n                        current_user={this.state.current_user}\r\n                        cart_counter={this.state.cart_counter}\r\n                        cart_total_price={this.state.cart_total_price}\r\n                    />\r\n                    <Switch>\r\n                        <Route exact path=\"/\" component={Mainpage}/>\r\n                        <Route path=\"/products/:itemId\" component={Productpage}/>\r\n                        <Route path=\"/addReview/:itemId\" component={addReview}/>\r\n                        <Route path=\"/chart\" component={ShoppingCart}/>\r\n                        <Route path=\"/orders\" component={Orders}/>\r\n                    </Switch>\r\n                    {this.state.toggleLogin && <Login loginCallback={this.handleLoginCallback}/>}\r\n                    {this.state.toggleRegister && <Register registerCallback={this.handleToggleLoginCallback}/>}\r\n                    {this.state.toggleShoppingCart &&\r\n                    <ShoppingCart\r\n                        postToCart={this.handleAddToCartCallback}\r\n                        quantity_increase={this.handleQuantityIncreaseCallback}\r\n                        quantity_decrease={this.handleQuantityDecreaseCallback}\r\n                        onCheckOut={this.handleCheckOutCallback}\r\n                        empty_cart={this.state.empty_cart}\r\n                        empty_cart_message={this.state.empty_cart_message}\r\n                        cart_objects={this.state.cart_objects}\r\n                        cart_total_price={this.state.cart_total_price}\r\n                        toggle_error_feedback={this.state.cart_error_feedback}\r\n                        toggle_success_feedback={this.state.cart_success_feedback}\r\n                        feedback_text={this.state.cart_feedback_text}\r\n                    />}\r\n                    <About/>\r\n                    <Footer toggle_admin={this.props.toggle_admin}/>\r\n                </React.Fragment>\r\n            </Router>\r\n        );\r\n    }\r\n}\r\n\r\nexport default Home;"]},"metadata":{},"sourceType":"module"}